## 本机基础信息收集
- 查看当前用户、权限
```cmd
whoami /all
```
- 查看网络配置信息
```CMD
ipconfig /all
```
>在域环境中DNS服务器的IP地址通常为域控制器地址

- 查看主机路由信息
```CMD
route print
```
- 查看操作系统信息
```CMD
systeminfo
systeninfo | findstr /B /C:"OS Name" /C:"OS Version"  # 查看操作系统及版本
systeminfo | findstr /B /C:"OS 名称" /C:"OS 版本"
```
- 查看端口连接信息
```CMD
netstat -ano
```
- 查看当前会话列表(需要管理员权限)
```CMD
net session
```
- 查看当前网络共享信息
```CMD
net share
```
- 查看已连接的网络共享
```CMD
net use
```
- 查看本地用户/组信息
```CMD
net user
net user <username> # 查看指定用户详细信息
net localgroup administrators # 查看本地管理员组
net user <username> <password> /add # 创建本地用户
nat localgroup administrators <username> /add # 将用户加入本地管理员组
```

- 查看当前进程信息
```CMD
tasklist
tasklist /SVC
```
- 查看当前登录用户
```CMD
query user
```
### WMIC
输入wmic可以进入WMIC的终端,wmic 提供了大量的命令行接口可以通过 /? 来获取帮助
```
/? 或 -? 显示所有全局开关和别名的语法  
/ /? /user /? 显示指定全局开关的信息  
/? class /? 显示某个命令的信息  
/? memcache /? 显示某个别名的信息  
/? temperature get /? 显示别名与动词组合的信息  
/?:Full irq get /?:Full 显示动词的帮助信息
```
>在查询多个条目时在终端中的显示会出现不全将终端变大就行
- 查询主机进程信息，并过滤出进程的路径，名称和PID
```CMD
process get Name,ProcessID,ExecutablePath
```
- 查看指定进程的路径信息
```CMD
process where Name="Obsidian.exe" get ExecutablePath
```
![](attachments/Pasted%20image%2020240811155534.png)
- 查看当前服务信息
```CMD
# 过滤出服务名称 路径 创建时间 运行状态
service get Caption,Name,PathName,StartName,State
# 查看指定服务
service where Name="backdoor" get Caption,PathName,State
```
- 查看自启动程序信息
```CMD
startup get Caption,Command,Location,User
```
- 查看应用安装信息
```CMD
product get Caption,Version
```
- 查看计划任务信息
```CMD
schtasks /query /v /fo list
```
## 域内基础信息收集
- 判断域环境是否存在
```CMD
net config workstation
```
- 查看域用户信息
```CMD
net user /domain
net user <username> /domain # 查询指定域用户信息
```
- 获取所有用户的SID、所属域和用户描述
```CMD
wmic useraccount get Caption,Domain,Description
```
- 查看域用户组信息
```CMD
net group /domain
net group "Domian Admins" /doamin
net group "Domian Computers" /domain
```
| 域组名称           | 说明                                         |
| ------------------ | -------------------------------------------- |
| Domian Admins      | 域管理员组，包括所有的域管理员用户           |
| Domain Computers   | 域成员主机组，包括加入域的所有工作站和服务器 |
| Domian Controllers | 域控制器组，包括域中所有域控制器             |
| Domain Guests      | 域来宾组，包括所有域用户                     |
| Enterprise Admins  | 企业系统管理员组，适用于域林范围             | 
- 查看域内密码策略
```CMD
net accounts /domain
```
- 查看指定域内域控制器列表
```CMD
nlsest /DCLIST:hack.com 
```
- 查看主域控制器
```CMD
net time /domain
```
>域环境中，主域控制器会被同时用作时间服务器，以此实现时间同步，通过查询时间服务器来找到主域控制器名称
- 定位域控制器
```CMD
ping DC.hack.com
```
>通常情况下，域控制器会被用作DNS服务器，可以通过定位DNS服务器来定位域控

- 查看域信任关系
```CMD
nltest /domian_trusts
```
## 内网资源探测
- 基于ICMP返现存货主机
```CMD
for /L %I in (1,1,254) DO @ping -W l -n l 10.10.10.%I | findstr "TTL="
```

## 用户凭据收集

## 域环境分析
### BloodHound
https://github.com/BloodHoundAD/BloodHound

