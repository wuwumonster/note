# 原理
## 推导
dp≡dmod(p−1)
-  $d p × e  \equiv d \times e mod (p-1)$
-  $d \times e \equiv k \times (p-1) + dp \times e$
-  $e \times d \equiv k_1(p-1)+e \times d mod(p-1)$ 
-  $e \times d \equiv k_1(p-1)+e \times dp$
-  $k_2 \times (p-1)(q-1)+1 = k_1(p-1)+e \times dp$
-  $[k_2(q-1)-k_1](p-1)+1=e \times dp$
设 $[k_2(q-1)-k_1]$ 为X
则有 $X*(p-1)+1=e \times dp$
- 由dp<(p-1)易有 X < e 
-  $x \in (0,e)$
-  $\frac{dp \times -1}{X} =(p-1)$
遍历x到得到合适的解即可
# 例题
## No Ciphertext RSA 
#dp泄露 #中国剩余定理 
### 加密脚本
```python
from Crypto.Util.number import *
import libnum
from secret import flag,p,q
e=65537
m=libnum.s2n(flag)
n=p*q
phi_n=(p-1)*(q-1)
d=libnum.invmod(e,phi_n)
dp=d%(p-1)
c=pow(m,e,n)
print("e =",e)
print("n =",n)
print("dp = ",dp)
leak_c1=c%p
leak_c2=c%q
print("leak_c1 =",leak_c1)
print("leak_c2 =",leak_c2)
"""
e = 65537
n = 20446305236294581881140725938833605520023786992590821920806811572505477606387830733060901955371457846738863889279107367753914707053108524516947943610226964107558978693717655472431318403586269727573489946433389159145602800207787382180423611018458189828931572992863289292613405218278949739073786959411566919119158325510346523951336418479951932209799501108477995314359188860274532542630968951457343647522078553891223764285682602714616115281040492374167771746275218863543545907073818468841626731849010162645256595641473022327747346052186526727216525426337190917106751151745388854749923598231196090790074682287345100965373
dp =  158325084409606165134868956023907667507671677832027168046364315703295407017343206432691817272550256085313093440797443736742051552429653661451417133052016647805226890534559578502154540190596419643135611407218228612201386225040438407799879719366484669372051153511312310009858718254183049095347658106745575535469
leak_c1 = 116908580792713727509554342060190793142033425411766631165842865699167747112494944492849392371565838125428644563687571660329763478509815200537676368326781342382868082294015200439334832938068779547847851748337854603115134732593759473453640093195977206450633212921689957303431235603192670553553803757864481012599
leak_c2 = 18319344794671185787719339480953236221170603508712466350928025351527616335735433941953520711516118072282425397883638101260674452825151245435529613074796106769481242318321469286177813223159476396555044378245229663195991557031227024085316255781963813911437991309663376270820486723382786632243229800891705679245
"""
```
### 解题脚本
```python
import gmpy2  
import libnum  
from Crypto.Util.number import *  
  
####   No Ciphertext RSA   ####  
  
e = 65537  
n = 20446305236294581881140725938833605520023786992590821920806811572505477606387830733060901955371457846738863889279107367753914707053108524516947943610226964107558978693717655472431318403586269727573489946433389159145602800207787382180423611018458189828931572992863289292613405218278949739073786959411566919119158325510346523951336418479951932209799501108477995314359188860274532542630968951457343647522078553891223764285682602714616115281040492374167771746275218863543545907073818468841626731849010162645256595641473022327747346052186526727216525426337190917106751151745388854749923598231196090790074682287345100965373  
dp = 158325084409606165134868956023907667507671677832027168046364315703295407017343206432691817272550256085313093440797443736742051552429653661451417133052016647805226890534559578502154540190596419643135611407218228612201386225040438407799879719366484669372051153511312310009858718254183049095347658106745575535469  
leak_c1 = 116908580792713727509554342060190793142033425411766631165842865699167747112494944492849392371565838125428644563687571660329763478509815200537676368326781342382868082294015200439334832938068779547847851748337854603115134732593759473453640093195977206450633212921689957303431235603192670553553803757864481012599  
leak_c2 = 18319344794671185787719339480953236221170603508712466350928025351527616335735433941953520711516118072282425397883638101260674452825151245435529613074796106769481242318321469286177813223159476396555044378245229663195991557031227024085316255781963813911437991309663376270820486723382786632243229800891705679245  
  
def op(x):  
    x_n = 1  
    for i in x:  
        x_n = x_n * i  
  
    return x_n  
  
def CRT(n, c):  
    ans = 0  
    n_n = op(n)  
    for n_i, c_i in zip(n, c):  
        m_i = n_n // n_i  
        m_ir = libnum.invmod(m_i, n_i)  
        ans = ans + (m_ir * m_i * c_i) % n_n  
  
    return ans % n_n  
  
  
  
for x in range(1, 65537):  
    if (dp * e - 1) % x == 0:  
        p = (((dp * e) - 1) // x) + 1  
        if n % p == 0:  
            q = n // p  
            break  
phi = (p - 1) * (q - 1)  
d = gmpy2.invert(e, phi)  
c_list = [leak_c1, leak_c2]  
n_list = [p, q]  
c = CRT(n_list, c_list)  
print(c)  
m = pow(c, d, n)  
flag = long_to_bytes(m)  
print(flag)
```
