## 签到·好玩的PHP
源码
```PHP
<?php  
    error_reporting(0);    highlight_file(__FILE__);  
  
    class ctfshow {  
        private $d = '';  
        private $s = '';  
        private $b = '';  
        private $ctf = '';  
  
        public function __destruct() {            $this->d = (string)$this->d;            $this->s = (string)$this->s;            $this->b = (string)$this->b;  
  
            if (($this->d != $this->s) && ($this->d != $this->b) && ($this->s != $this->b)) {                $dsb = $this->d.$this->s.$this->b;  
  
                if ((strlen($dsb) <= 3) && (strlen($this->ctf) <= 3)) {  
                    if (($dsb !== $this->ctf) && ($this->ctf !== $dsb)) {  
                        if (md5($dsb) === md5($this->ctf)) {  
                            echo file_get_contents("/flag.txt");  
                        }  
                    }  
                }  
            }  
        }  
    }    unserialize($_GET["dsbctf"]);
```

利用浮点数常量INF使dsb为字符串类型，ctf为浮点型，而md5使用字符串加密使得md5值相等


## 迷雾重重
app/controller/IndexController.php

```PHP
<?php  
  
namespace app\controller;  
  
use support\Request;  
use support\exception\BusinessException;  
  
class IndexController  
{  
    public function index(Request $request)  
    {  
          
        return view('index/index');  
    }  
  
    public function testUnserialize(Request $request){  
        if(null !== $request->get('data')){  
            $data = $request->get('data');  
            unserialize($data);  
        }  
        return "unserialize测试完毕";  
    }  
  
    public function testJson(Request $request){  
        if(null !== $request->get('data')){  
            $data = ($request->get('data'),true);  
            if(null!== $data && $data['name'] == 'guest'){  
                return view('index/view', $data);  
            }  
        }  
        return "json_decode测试完毕";  
    }  
  
    public function testSession(Request $request){  
        $session = $request->session();  
        $session->set('username',"guest");  
        $data = $session->get('username');  
        return "session测试完毕 username: ".$data;  
  
    }  
  
    public function testException(Request $request){  
        if(null != $request->get('data')){  
            $data = $request->get('data');  
            throw new BusinessException("业务异常 ".$data,3000);  
        }  
        return "exception测试完毕";  
    }  
  
  
}
```

没有什么可用利用点，和显眼的反序列化连，唯一只有view比较扎眼，可能是ssti，跟一下

![](attachments/Pasted%20image%2020241201204001.png)

