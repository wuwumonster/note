# 2022长城杯

# web

## djangogogo

CVE2022-34265

?name={{}}

发现字段名sale_datetime,结合CVE进行报错注入

?name=year+from sale_datetime))+and+updatexml(1,concat(1,(select database()),1),1)—

![Untitled](attachments/Untitled%208.png)

## b4bycoffee
jar包解压开之后，依赖项中有rome1.7猜测考察的是rome反序列化链

AntObjectInputStream
```java
  
package com.example.b4bycoffee.tools;  
  
import com.rometools.rome.feed.impl.ObjectBean;  
import com.rometools.rome.feed.impl.ToStringBean;  
import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;  
import java.io.IOException;  
import java.io.InputStream;  
import java.io.InvalidClassException;  
import java.io.ObjectInputStream;  
import java.io.ObjectStreamClass;  
import java.util.ArrayList;  
import java.util.List;  
import javax.management.BadAttributeValueExpException;  
  
public class AntObjectInputStream extends ObjectInputStream {  
    private List<String> list = new ArrayList();  
  
    public AntObjectInputStream(InputStream inputStream) throws IOException {  
        super(inputStream);  
        this.list.add(BadAttributeValueExpException.class.getName());  
        this.list.add(ObjectBean.class.getName());  
        this.list.add(ToStringBean.class.getName());  
        this.list.add(TemplatesImpl.class.getName());  
        this.list.add(Runtime.class.getName());  
    }  
  
    protected Class<?> resolveClass(ObjectStreamClass desc) throws IOException, ClassNotFoundException {  
        if (this.list.contains(desc.getName())) {  
            throw new InvalidClassException("Unauthorized deserialization attempt", desc.getName());  
        } else {  
            return super.resolveClass(desc);  
        }  
    }  
}
```
明显的一个黑名单，ban掉了rome链中的重要类，但是在CoffeeBean中明显设置了一个ToStringBean的平替来实现defineClass
这里使用EqualsBean.class的beanHashCode触发toString
黑名单还ban掉了`TemplatesImpl`，那么这里需要使用别的方法来加载字节码了，发现很多师傅的博客是在cc2的时候有ClassPool的使用
这里给一个关于Javassist动态变成的博客，[Java安全之Javassist动态编程 - nice_0e3 - 博客园 (cnblogs.com)](https://www.cnblogs.com/nice0e3/p/13811335.html)

# misc

## 签名簿

签字拿flag