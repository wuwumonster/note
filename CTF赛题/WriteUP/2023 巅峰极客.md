# Web
## unserialize

`www.zip`获取源码
index.php
```php
<?php  
include_once "my.php";  
include_once "function.php";  
include_once "login.html";  
session_start();  
  
if (isset($_POST['root']) && isset($_POST['pwd'])) {  
   $root = $_POST['root'];  
   $pwd = $_POST['pwd'];  
   $login = new push_it($root, $pwd);  
   $_SESSION['login'] = b(serialize($login));  
   die('<script>location.href=`./login.php`;</script>');  
}  
  
  
  
?>
```

my.php
```php
<?php  
  
class pull_it {  
   private $x;  
  
   function __construct($xx) {  
      $this->x = $xx;  
   }  
  
   function __destruct() {  
      if ($this->x) {  
         $preg_match = 'return preg_match("/[A-Za-z0-9]+/i", $this->x);';  
      if (eval($preg_match)) {  
         echo $preg_match;  
         exit("save_waf");  
      }  
      @eval($this->x);  
      }  
   }  }  
class push_it {  
   private $root;  
   private $pwd;  
  
   function __construct($root, $pwd) {  
      $this->root = $root;  
      $this->pwd = $pwd;  
   }  
   function __destruct() {  
      unset($this->root);  
      unset($this->pwd);  
   }  
  
   function __toString() {  
      if (isset($this->root) && isset($this->pwd)) {  
         echo "<h1>Hello, $this->root</h1>";  
      }  
      else {  
         echo "<h1>out!</h1>";  
      }  
   }  
  
  
}  
  
  
  
?>
```

function.php
```php
<?php  
function b($data) {  
   return str_replace('aaaa', 'bbbbbb', $data);  
}  
  
function a($data) {  
   return str_replace('bbbbbb', 'aaaa', $data);  
}  
?>
```


就是无数字字母rce加上反序列化字符串逃逸

index.php中生成的$login 的格式是 `O:7:"push_it":2:{s:13:"push_itroot";s:4:"root";s:12:"push_itpwd";s:3:"pwd";}`

在后面会将 bbbbb转化为aaaa 6-> 4 因此每有一组bbbbbb 就可以逃逸两个字符
这里使用`/???/??? /*` 来指 `/bin/cat /*` 手工制作的payload是 `O:7:"pull_it":1:{s:1:"x";s:11:"/???/??? /*";}`